{
  Context context=(Context)WebContextFactory.get().getSession().getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  if (context != null && context.isAuthenticated()) {
    FormService fs=context.getFormService();
    ConceptService cs=context.getConceptService();
    FormField ff;
    if (formFieldId != null && formFieldId != 0)     ff=fs.getFormField(formFieldId);
 else     ff=new FormField(formFieldId);
    ff.setForm(fs.getForm(formId));
    if (!ff.getFormFieldId().equals(parent))     ff.setParent(fs.getFormField(parent));
    ff.setFieldNumber(number);
    ff.setFieldPart(part);
    ff.setPageNumber(page);
    ff.setMinOccurs(min);
    ff.setMaxOccurs(max);
    ff.setRequired(required);
    log.debug("fieldId: " + fieldId);
    log.debug("formFieldId: " + formFieldId);
    log.debug("parentId: " + parent);
    log.debug("parent: " + ff.getParent());
    Field field;
    if (fieldId != null && fieldId != 0)     field=fs.getField(fieldId);
 else     field=new Field(fieldId);
    field.setName(name);
    field.setDescription(fieldDesc);
    field.setFieldType(fs.getFieldType(fieldTypeId));
    if (conceptId != null && conceptId != 0)     field.setConcept(cs.getConcept(conceptId));
    field.setTableName(table);
    field.setAttributeName(attr);
    field.setSelectMultiple(multiple);
    ff.setField(field);
    fs.updateFormField(ff);
    context.endTransaction();
  }
  return;
}
