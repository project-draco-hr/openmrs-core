{
  Criteria criteria=sessionFactory.getCurrentSession().createCriteria(Concept.class);
  criteria.add(Expression.eq("retired",false));
  if (name != null) {
    if (loc == null)     throw new DAOException("Locale must be not null");
    criteria.createAlias("names","names");
    MatchMode matchmode=MatchMode.EXACT;
    if (searchOnPhrase)     matchmode=MatchMode.ANYWHERE;
    criteria.add(Expression.like("names.name",name,matchmode));
    String language=loc.getLanguage();
    if (language.length() > 2) {
      criteria.add(Expression.or(Expression.eq("names.locale",loc.getLanguage()),Expression.eq("names.locale",loc.getLanguage().substring(0,2))));
    }
 else {
      criteria.add(Expression.like("names.locale",loc.getLanguage(),MatchMode.START));
    }
  }
  if (classes.size() > 0)   criteria.add(Expression.in("conceptClass",classes));
  if (datatypes.size() > 0)   criteria.add(Expression.in("datatype",datatypes));
  return criteria.list();
}
