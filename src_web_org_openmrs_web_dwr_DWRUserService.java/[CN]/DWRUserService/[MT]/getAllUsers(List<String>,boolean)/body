{
  Vector userList=new Vector();
  HttpServletRequest request=WebContextFactory.get().getHttpServletRequest();
  Context context=(Context)request.getSession(false).getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  if (context == null) {
    userList.add("Your session has expired.");
    userList.add("Please <a href='" + request.getContextPath() + "/logout'>log in</a> again.");
  }
 else {
    try {
      FormEntryService fs=context.getFormEntryService();
      Set<User> users=new HashSet<User>();
      if (roles == null)       roles=new Vector<String>();
      users.addAll(fs.getAllUsers(roles,includeVoided));
      userList=new Vector(users.size());
      for (      User u : users) {
        userList.add(new UserListItem(u));
      }
    }
 catch (    Exception e) {
      log.error(e);
      userList.add("Error while attempting to get users - " + e.getMessage());
    }
  }
  return userList;
}
