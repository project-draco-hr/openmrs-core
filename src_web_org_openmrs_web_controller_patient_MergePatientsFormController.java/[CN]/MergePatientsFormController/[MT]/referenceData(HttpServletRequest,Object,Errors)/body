{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  Map<String,Object> map=new HashMap<String,Object>();
  Patient p1=(Patient)obj;
  Patient p2=new Patient();
  Collection<Encounter> patient1Encounters=new Vector<Encounter>();
  Collection<Encounter> patient2Encounters=new Vector<Encounter>();
  if (context != null && context.isAuthenticated()) {
    EncounterService es=context.getEncounterService();
    patient1Encounters=es.getEncounters(p1);
    String[] patientIds=request.getParameterValues("patientId");
    if (patientIds != null && patientIds.length > 1 && !patientIds[0].equals(patientIds[1])) {
      String patientId=patientIds[1];
      Integer pId=Integer.valueOf(patientId);
      p2=context.getPatientService().getPatient(pId);
      patient2Encounters=es.getEncounters(p2);
    }
  }
  map.put("patient1Encounters",patient1Encounters);
  map.put("patient2Encounters",patient2Encounters);
  map.put("patient2",p2);
  return map;
}
