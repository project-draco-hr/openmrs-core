{
  try {
    JFreeChart chart=getChart(request);
    String widthString=request.getParameter("width");
    String heightString=request.getParameter("height");
    Integer width;
    Integer height;
    if (widthString != null && widthString.length() > 0)     width=Integer.parseInt(widthString);
 else     width=500;
    if (heightString != null && heightString.length() > 0)     height=Integer.parseInt(heightString);
 else     height=300;
    String mimeType=request.getParameter("mimeType");
    if (mimeType == null)     mimeType=PNG_MIME_TYPE;
    response.setHeader("Pragma","No-cache");
    response.setDateHeader("Expires",0);
    response.setHeader("Cache-Control","no-cache");
    try {
      if (JPG_MIME_TYPE.equalsIgnoreCase(mimeType)) {
        response.setContentType(JPG_MIME_TYPE);
        ChartUtilities.writeChartAsJPEG(response.getOutputStream(),chart,width,height);
      }
 else       if (PNG_MIME_TYPE.equalsIgnoreCase(mimeType)) {
        response.setContentType(PNG_MIME_TYPE);
        ChartUtilities.writeChartAsPNG(response.getOutputStream(),chart,width,height);
      }
 else {
        throw new APIException("Unsupported MIME type");
      }
    }
 catch (    IOException e) {
      if (e.getClass().getName().equals("org.apache.catalina.connector.ClientAbortException")) {
      }
 else {
        log.error("Error class name: " + e.getClass().getName());
        log.error("Unable to write chart",e);
      }
    }
  }
 catch (  Exception e) {
    log.error("An unknown expected exception was thrown while rendering a graph",e);
  }
}
