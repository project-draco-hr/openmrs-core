{
  Patient patient=Context.getPatientService().getPatient(patientId);
  Concept concept=Context.getConceptService().getConceptByName(conceptName);
  if (concept != null && concept.isNumeric()) {
    List<Obs> observations=Context.getObsService().getObservationsByPersonAndConcept(patient,concept);
    DefaultCategoryDataset dataset=new DefaultCategoryDataset();
    for (    Obs obs : observations) {
      dataset.addValue(obs.getValueNumeric(),conceptName,obs.getObsDatetime());
    }
    JFreeChart chart=ChartFactory.createLineChart(conceptName,"Value","Date",dataset,PlotOrientation.VERTICAL,true,true,false);
    try {
      ByteArrayOutputStream byteArray=new ByteArrayOutputStream();
      ChartUtilities.writeChartAsPNG(byteArray,chart,width,height);
      pageContext.getResponse().setContentType("image/png");
      pageContext.getResponse().getWriter().write(byteArray.toString());
    }
 catch (    IOException e) {
      log.error(e);
    }
  }
  return EVAL_BODY_BUFFERED;
}
