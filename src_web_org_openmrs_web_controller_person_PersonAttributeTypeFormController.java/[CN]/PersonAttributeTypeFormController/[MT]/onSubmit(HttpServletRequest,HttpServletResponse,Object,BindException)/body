{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    PersonAttributeType attrType=(PersonAttributeType)obj;
    if (attrType.getSortWeight() == null) {
      List<PersonAttributeType> allTypes=Context.getPersonService().getAllPersonAttributeTypes();
      if (allTypes.size() > 0)       attrType.setSortWeight(allTypes.get(allTypes.size() - 1).getSortWeight() + 1);
 else       attrType.setSortWeight(1);
    }
    Context.getPersonService().savePersonAttributeType(attrType);
    view=getSuccessView();
    httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,"PersonAttributeType.saved");
  }
  return new ModelAndView(new RedirectView(view));
}
