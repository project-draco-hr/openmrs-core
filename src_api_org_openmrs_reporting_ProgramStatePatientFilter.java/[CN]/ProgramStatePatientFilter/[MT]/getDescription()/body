{
  StringBuilder ret=new StringBuilder();
  ret.append("Patients in program ");
  if (getProgram() != null) {
    if (getProgram().getConcept() == null)     ret.append(" <CONCEPT> ");
 else {
      ret.append(getConceptName(program.getConcept()));
    }
  }
  if (state != null) {
    ProgramWorkflow workflow=state.getProgramWorkflow();
    if (workflow.getConcept() == null)     workflow=Context.getProgramWorkflowService().getWorkflow(state.getProgramWorkflow().getProgramWorkflowId());
    Concept stateConcept=state.getConcept();
    if (stateConcept == null)     stateConcept=Context.getProgramWorkflowService().getState(state.getProgramWorkflowStateId()).getConcept();
    ret.append("with " + getConceptName(workflow.getConcept()) + " of "+ getConceptName(stateConcept)+ " ");
  }
  if (withinLastMonths != null || withinLastDays != null) {
    ret.append("within the last ");
    if (withinLastMonths != null)     ret.append(withinLastMonths + " month(s) ");
    if (withinLastDays != null)     ret.append(withinLastDays + " day(s) ");
  }
  if (sinceDate != null)   ret.append("on or after " + sinceDate + " ");
  if (untilDate != null)   ret.append("on or before " + untilDate + " ");
  return ret.toString();
}
