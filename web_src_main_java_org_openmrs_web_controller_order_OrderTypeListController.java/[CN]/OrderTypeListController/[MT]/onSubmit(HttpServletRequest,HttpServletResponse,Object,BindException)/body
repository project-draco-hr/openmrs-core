{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String success="";
    String error="";
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String[] orderTypeList=request.getParameterValues("orderTypeId");
    if (orderTypeList != null) {
      OrderService os=Context.getOrderService();
      String deleted=msa.getMessage("general.deleted");
      String notDeleted=msa.getMessage("OrderType.cannot.delete");
      for (      String p : orderTypeList) {
        try {
          os.purgeOrderType(os.getOrderType(Integer.valueOf(p)));
          if (!success.equals(""))           success+="<br/>";
          success+=p + " " + deleted;
        }
 catch (        DataIntegrityViolationException e) {
          error=handleOrderTypeIntegrityException(e,error,notDeleted);
        }
catch (        APIException e) {
          error=handleOrderTypeIntegrityException(e,error,notDeleted);
        }
      }
    }
 else     error=msa.getMessage("OrderType.select");
    view=getSuccessView();
    if (!success.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success);
    if (!error.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error);
  }
  return new ModelAndView(new RedirectView(view));
}
