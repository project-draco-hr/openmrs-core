{
  Log log=LogFactory.getLog(Listener.class);
  log.debug("Starting the OpenMRS webapp");
  try {
    ServletContext servletContext=event.getServletContext();
    loadConstants(servletContext);
    clearDWRFile(servletContext);
    Properties props=getRuntimeProperties();
    Thread.currentThread().setContextClassLoader(OpenmrsClassLoader.getInstance());
    if (props != null) {
      runtimePropertiesFound=true;
      Context.setRuntimeProperties(props);
      copyCustomizationIntoWebapp(servletContext,props);
      super.contextInitialized(event);
      try {
        Context.openSession();
        Context.startup(props);
        loadCoreModules(servletContext);
        performWebStartOfModules(servletContext);
        SchedulerUtil.startup(props);
      }
  finally {
        Context.closeSession();
      }
    }
  }
 catch (  DatabaseUpdateException updateException) {
    log.error("Unable to update the database to the latest version",updateException);
    throw new RuntimeException("Unable to update the database to the latest version.  See the logs for more information",updateException);
  }
catch (  Throwable t) {
    log.warn("Got exception while starting up: ",t);
  }
}
