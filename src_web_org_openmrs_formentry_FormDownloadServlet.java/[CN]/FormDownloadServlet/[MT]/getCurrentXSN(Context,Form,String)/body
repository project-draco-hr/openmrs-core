{
  log.debug("Attempting to open xsn from: " + formFilePath);
  try {
    FileInputStream formStream=new FileInputStream(formFilePath);
  }
 catch (  FileNotFoundException e) {
    log.warn(e);
    return null;
  }
  String schemaFilename=FormEntryConstants.FORMENTRY_DEFAULT_SCHEMA_NAME;
  String templateFilename=FormEntryConstants.FORMENTRY_DEFAULT_TEMPLATE_NAME;
  String sampleDataFilename=FormEntryConstants.FORMENTRY_DEFAULT_SAMPLEDATA_NAME;
  String url=FormUtil.getFormAbsoluteUrl(form);
  File tmpXSN=FormEntryUtil.expandXsn(formFilePath);
  String schema=new FormSchemaBuilder(context,form).getSchema();
  String template=new FormXmlTemplateBuilder(context,form,url).getXmlTemplate((Patient)null);
  template=template.replaceAll("@SESSION@","");
  File schemaFile=FormEntryUtil.findFile(tmpXSN,schemaFilename);
  if (schemaFile == null)   throw new IOException("Schema: '" + schemaFilename + "' cannot be null");
  FileWriter schemaOutput=new FileWriter(schemaFile,false);
  schemaOutput.write(schema);
  schemaOutput.close();
  File templateFile=FormEntryUtil.findFile(tmpXSN,templateFilename);
  if (templateFile == null)   throw new IOException("Template: '" + templateFilename + "' cannot be null");
  FileWriter templateOutput=new FileWriter(templateFile,false);
  templateOutput.write(template);
  templateOutput.close();
  File sampleDataFile=FormEntryUtil.findFile(tmpXSN,sampleDataFilename);
  if (sampleDataFile == null)   throw new IOException("Template: '" + sampleDataFilename + "' cannot be null");
  FileWriter sampleDataOutput=new FileWriter(sampleDataFile,false);
  sampleDataOutput.write(template);
  sampleDataOutput.close();
  FormEntryUtil.createDdf(tmpXSN,tmpXSN.getAbsolutePath(),"new.xsn");
  FormEntryUtil.makeCab(tmpXSN);
  File xsn=FormEntryUtil.findFile(tmpXSN,"new.xsn");
  FileInputStream xsnInputStream=new FileInputStream(xsn);
  return xsnInputStream;
}
