{
  executeDataSet(COMPLEX_OBS_XML);
  BufferedImage image=createImage();
  Obs o=new Obs();
  o.setConcept(null);
  Obs o1=new Obs();
  o1.setConcept(Context.getConceptService().getConcept(8473));
  o1.setComplexData(new ComplexData("complex_obs_image_test.gif",image));
  Encounter e=new Encounter();
  e.addObs(o);
  e.addObs(o1);
  File createdFile=null;
  EncounterSaveHandler handler=new EncounterSaveHandler();
  try {
    handler.handle(e,null,null,null);
    File complexObsDir=OpenmrsUtil.getDirectoryInApplicationDataDirectory(Context.getAdministrationService().getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_COMPLEX_OBS_DIR));
    createdFile=new File(complexObsDir,o1.getValueComplex().split("\\|")[1]);
    Assert.assertTrue(createdFile.exists());
  }
 catch (  Exception ex) {
    Assert.fail();
  }
 finally {
    if (createdFile != null && createdFile.exists())     createdFile.delete();
  }
}
