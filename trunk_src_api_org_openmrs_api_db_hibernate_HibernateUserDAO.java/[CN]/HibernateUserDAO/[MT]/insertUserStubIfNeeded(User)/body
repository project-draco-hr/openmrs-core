{
  Connection connection=sessionFactory.getCurrentSession().connection();
  boolean stubInsertNeeded=false;
  if (user.getUserId() != null) {
    try {
      PreparedStatement ps=connection.prepareStatement("SELECT * FROM users WHERE user_id = ?");
      ps.setInt(1,user.getUserId());
      ps.execute();
      if (ps.getResultSet().next())       stubInsertNeeded=false;
 else       stubInsertNeeded=true;
    }
 catch (    SQLException e) {
      log.error("Error while trying to see if this person is a user already",e);
    }
  }
  if (stubInsertNeeded) {
    try {
      PreparedStatement ps=connection.prepareStatement("INSERT INTO users (user_id, system_id, creator, date_created, voided) VALUES (?, ?, ?, ?, ?)");
      ps.setInt(1,user.getUserId());
      ps.setString(2,user.getSystemId());
      ps.setInt(3,user.getCreator().getUserId());
      ps.setDate(4,new java.sql.Date(user.getDateCreated().getTime()));
      ps.setBoolean(5,false);
      ps.executeUpdate();
    }
 catch (    SQLException e) {
      log.warn("SQL Exception while trying to create a user stub",e);
    }
  }
}
