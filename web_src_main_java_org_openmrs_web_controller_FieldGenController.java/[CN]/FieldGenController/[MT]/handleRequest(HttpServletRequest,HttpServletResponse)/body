{
  Object uri=request.getAttribute("javax.servlet.include.servlet_path.fieldGen");
  if (uri == null) {
    uri=request.getAttribute("javax.servlet.include.servlet_path");
  }
  String fieldGenPath="";
  Map<String,Object> model=new HashMap<String,Object>();
  if (uri != null) {
    fieldGenPath=uri.toString();
    if (fieldGenPath.endsWith("field")) {
      fieldGenPath=fieldGenPath.replace(".field","");
    }
 else     if (fieldGenPath.endsWith("jsp")) {
      throw new ServletException("Illegal extension used for fieldGen: '.jsp'. Allowable extensions are '' (no extension) and '.field'");
    }
    String type=(String)request.getAttribute("org.openmrs.fieldGen.type");
    String formFieldName=(String)request.getAttribute("org.openmrs.fieldGen.formFieldName");
    Map<String,Object> params=(Map<String,Object>)request.getAttribute("org.openmrs.fieldGen.parameters");
    Map<String,Object> moreParams=(Map<String,Object>)request.getAttribute("org.openmrs.fieldGen.parameterMap");
    model.put("type",type);
    model.put("formFieldName",formFieldName);
    model.put("obj",request.getAttribute("org.openmrs.fieldGen.object"));
    model.put("request",request.getAttribute("org.openmrs.fieldGen.request"));
    model.putAll(params);
    if (moreParams != null) {
      model.putAll(moreParams);
    }
    request.removeAttribute("org.openmrs.fieldGen.type");
    request.removeAttribute("org.openmrs.fieldGen.formFieldName");
    request.removeAttribute("org.openmrs.fieldGen.object");
    request.removeAttribute("org.openmrs.fieldGen.parameters");
    request.removeAttribute("org.openmrs.fieldGen.parameterMap");
  }
  return new ModelAndView(fieldGenPath,"model",model);
}
