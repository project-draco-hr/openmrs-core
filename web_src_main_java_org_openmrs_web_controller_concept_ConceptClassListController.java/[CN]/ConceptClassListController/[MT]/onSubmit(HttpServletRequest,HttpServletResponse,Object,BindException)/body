{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    StringBuilder success=new StringBuilder();
    String error="";
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String[] conceptClassList=request.getParameterValues("conceptClassId");
    if (conceptClassList != null) {
      ConceptService cs=Context.getConceptService();
      String deleted=msa.getMessage("general.deleted");
      String notDeleted=msa.getMessage("ConceptClass.cannot.delete");
      for (      String cc : conceptClassList) {
        try {
          cs.purgeConceptClass(cs.getConceptClass(Integer.valueOf(cc)));
          if (!"".equals(success.toString())) {
            success.append("<br/>");
          }
          success.append(cc).append(" ").append(deleted);
        }
 catch (        DataIntegrityViolationException e) {
          error=handleConceptClassIntegrityException(e,error,notDeleted);
        }
catch (        APIException e) {
          error=handleConceptClassIntegrityException(e,error,notDeleted);
        }
      }
    }
 else {
      error=msa.getMessage("ConceptClass.select");
    }
    view=getSuccessView();
    if (!"".equals(success.toString())) {
      httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success.toString());
    }
    if (!"".equals(error)) {
      httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error);
    }
  }
  return new ModelAndView(new RedirectView(view));
}
