{
  Obs obs=null;
  if (Context.isAuthenticated()) {
    ObsService os=Context.getObsService();
    EncounterService es=Context.getEncounterService();
    String obsId=request.getParameter("obsId");
    String encounterId=request.getParameter("encounterId");
    if (obsId != null)     obs=os.getObs(Integer.valueOf(obsId));
 else     if (StringUtils.hasText(encounterId)) {
      Encounter e=es.getEncounter(Integer.valueOf(encounterId));
      obs=new Obs();
      obs.setEncounter(e);
      obs.setPerson(e.getPatient());
      obs.setLocation(e.getLocation());
      obs.setObsDatetime(e.getEncounterDatetime());
    }
  }
  if (obs == null)   obs=new Obs();
  return obs;
}
