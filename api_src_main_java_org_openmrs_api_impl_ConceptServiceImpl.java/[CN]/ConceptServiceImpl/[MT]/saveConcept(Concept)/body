{
  checkIfLocked();
  checkIfDatatypeCanBeChanged(concept);
  List<ConceptName> changedConceptNames=null;
  Map<String,ConceptName> uuidClonedConceptNameMap=null;
  if (concept.getConceptId() != null) {
    uuidClonedConceptNameMap=new HashMap<String,ConceptName>();
    for (    ConceptName conceptName : concept.getNames()) {
      if (conceptName.getConceptNameId() != null) {
        ConceptName clone=cloneConceptName(conceptName);
        clone.setConceptNameId(null);
        uuidClonedConceptNameMap.put(conceptName.getUuid(),clone);
        if (hasNameChanged(conceptName)) {
          if (changedConceptNames == null)           changedConceptNames=new ArrayList<ConceptName>();
          changedConceptNames.add(conceptName);
        }
 else {
          clone.setConceptNameId(conceptName.getConceptNameId());
          try {
            BeanUtils.copyProperties(conceptName,clone);
          }
 catch (          IllegalAccessException e) {
            log.error("Error generated",e);
          }
catch (          InvocationTargetException e) {
            log.error("Error generated",e);
          }
        }
      }
    }
  }
  if (CollectionUtils.isNotEmpty(changedConceptNames)) {
    for (    ConceptName changedName : changedConceptNames) {
      ConceptName nameInDB=changedName;
      nameInDB.setVoided(true);
      nameInDB.setDateVoided(new Date());
      nameInDB.setVoidedBy(Context.getAuthenticatedUser());
      nameInDB.setVoidReason(Context.getMessageSourceService().getMessage("Concept.name.voidReason.nameChanged"));
      if (!nameInDB.isSynonym())       nameInDB.setConceptNameType(null);
      if (nameInDB.isLocalePreferred())       nameInDB.setLocalePreferred(false);
      ConceptName clone=uuidClonedConceptNameMap.get(nameInDB.getUuid());
      clone.setUuid(UUID.randomUUID().toString());
      concept.addName(clone);
    }
  }
  Errors errors=new BindException(concept,"concept");
  new ConceptValidator().validate(concept,errors);
  if (errors.hasErrors())   throw new APIException("Validation errors found: " + errors.getAllErrors());
  for (  Locale locale : LocaleUtility.getLocalesInOrder()) {
    ConceptName possiblePreferredName=concept.getPreferredName(locale);
    if (possiblePreferredName == null || !possiblePreferredName.isLocalePreferred()) {
      if (possiblePreferredName != null)       possiblePreferredName.setLocalePreferred(true);
 else       if (!CollectionUtils.isEmpty(concept.getSynonyms(locale)))       concept.getSynonyms(locale).iterator().next().setLocalePreferred(true);
    }
  }
  Concept conceptToReturn=dao.saveConcept(concept);
  this.updateConceptIndex(conceptToReturn);
  return conceptToReturn;
}
