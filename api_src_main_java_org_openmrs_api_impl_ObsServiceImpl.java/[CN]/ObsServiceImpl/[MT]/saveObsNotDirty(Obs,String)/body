{
  if (!obs.isObsGrouping()) {
    return obs;
  }
  ObsService os=Context.getObsService();
  List<Obs> toRemove=new ArrayList<>();
  List<Obs> toAdd=new ArrayList<>();
  for (  Obs o : obs.getGroupMembers(true)) {
    if (o.getId() == null) {
      os.saveObs(o,null);
    }
 else {
      Obs replacement=os.saveObs(o,changeMessage);
      toRemove.add(o);
      toAdd.add(os.getObs(o.getId()));
      toAdd.add(replacement);
    }
  }
  for (  Obs o : toRemove) {
    obs.removeGroupMember(o);
  }
  for (  Obs o : toAdd) {
    obs.addGroupMember(o);
  }
  return obs;
}
