{
  XCN hl7Provider=pv1.getAttendingDoctor(0);
  Provider provider=null;
  String id=hl7Provider.getIDNumber().getValue();
  String assignAuth=((HD)hl7Provider.getComponent(8)).getNamespaceID().getValue();
  String nameTypeCode=((ID)hl7Provider.getComponent(9)).getValue();
  if (StringUtils.hasText(id)) {
    if (OpenmrsUtil.nullSafeEquals("L",nameTypeCode)) {
      if (HL7Constants.PROVIDER_ASSIGNING_AUTH_PROV_ID.equalsIgnoreCase(assignAuth)) {
        try {
          provider=Context.getProviderService().getProvider(Integer.valueOf(id));
        }
 catch (        NumberFormatException e) {
        }
      }
 else       if (HL7Constants.PROVIDER_ASSIGNING_AUTH_IDENTIFIER.equalsIgnoreCase(assignAuth)) {
        provider=Context.getProviderService().getProviderByIdentifier(id);
      }
 else       if (HL7Constants.PROVIDER_ASSIGNING_AUTH_PROV_UUID.equalsIgnoreCase(assignAuth)) {
        provider=Context.getProviderService().getProviderByUuid(id);
      }
    }
 else {
      try {
        Person person=Context.getPersonService().getPerson(Integer.valueOf(id));
        Collection<Provider> providers=Context.getProviderService().getProvidersByPerson(person);
        if (!providers.isEmpty())         provider=providers.iterator().next();
      }
 catch (      NumberFormatException e) {
      }
    }
  }
  if (provider == null)   throw new HL7Exception("Could not resolve provider with personId or identifier as '" + id + "'");
  return provider;
}
