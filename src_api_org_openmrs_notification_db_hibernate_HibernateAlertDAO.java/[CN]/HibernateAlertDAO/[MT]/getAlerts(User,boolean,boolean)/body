{
  log.debug("Getting alerts for user " + user + " read? "+ includeRead+ " expired? "+ includeExpired);
  Criteria crit=sessionFactory.getCurrentSession().createCriteria(Alert.class,"alert");
  if (user != null && user.getUserId() != null) {
    crit.createCriteria("recipients","recipient");
    crit.add(Expression.eq("recipient.recipient",user));
  }
 else {
    return Collections.emptyList();
  }
  if (includeExpired == false)   crit.add(Expression.or(Expression.isNull("dateToExpire"),Expression.gt("dateToExpire",new Date())));
  if (includeRead == false && (user != null && user.getUserId() != null)) {
    crit.add(Expression.eq("alertRead",false));
    crit.add(Expression.eq("recipient.alertRead",false));
  }
  crit.addOrder(Order.desc("dateChanged"));
  return crit.list();
}
