{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  Concept concept=(Concept)object;
  Locale locale=RequestContextUtils.getLocale(request);
  if (context != null && context.isAuthenticated()) {
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String action=request.getParameter("action");
    if (!action.equals(msa.getMessage("Concept.delete"))) {
      log.debug("newSynonyms: " + request.getParameter("newSynonyms"));
      String[] tempSyns=request.getParameter("newSynonyms").split(",");
      log.debug("tempSyns: ");
      for (      String s : tempSyns)       log.debug(s);
      Collection<ConceptSynonym> originalSyns=concept.getSynonyms();
      Set<ConceptSynonym> parameterSyns=new HashSet<ConceptSynonym>();
      for (      String syn : tempSyns) {
        syn=syn.trim();
        if (!syn.equals(""))         parameterSyns.add(new ConceptSynonym(concept,syn.toUpperCase(),locale));
      }
      log.debug("initial originalSyns: ");
      for (      ConceptSynonym s : originalSyns)       log.debug(s);
      Set<ConceptSynonym> originalSynsCopy=new HashSet<ConceptSynonym>();
      originalSynsCopy.addAll(originalSyns);
      for (      ConceptSynonym o : originalSynsCopy) {
        if (o.getLocale().equals(locale.getLanguage().substring(0,2)) && !parameterSyns.contains(o)) {
          originalSyns.remove(o);
        }
      }
      for (      ConceptSynonym p : parameterSyns) {
        if (!originalSyns.contains(p)) {
          originalSyns.add(p);
        }
      }
      log.debug("evaluated parameterSyns: ");
      for (      ConceptSynonym s : parameterSyns)       log.debug(s);
      log.debug("evaluated originalSyns: ");
      for (      ConceptSynonym s : originalSyns)       log.debug(s);
      concept.setSynonyms(originalSyns);
      String conceptSets=request.getParameter("conceptSets");
      if (conceptSets == null)       concept.setConceptSets(null);
      String conceptName=request.getParameter("name").toUpperCase();
      if (conceptName.length() < 1)       errors.rejectValue("name","error.name");
      String shortName=request.getParameter("shortName");
      String description=request.getParameter("description");
      if (conceptName.length() < 1)       errors.rejectValue("description","error.description");
      ConceptName cn=concept.getName(locale,true);
      if (cn != null) {
        cn.setName(conceptName);
        cn.setShortName(shortName);
        cn.setDescription(description);
      }
 else {
        concept.addName(new ConceptName(conceptName,shortName,description,locale));
      }
    }
  }
 else {
    errors.reject("auth.invalid");
  }
  return super.processFormSubmission(request,response,concept,errors);
}
