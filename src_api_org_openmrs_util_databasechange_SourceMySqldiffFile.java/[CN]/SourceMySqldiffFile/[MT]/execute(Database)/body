{
  Properties runtimeProperties=Context.getRuntimeProperties();
  if (runtimeProperties.size() == 0)   return;
  DatabaseConnection connection=database.getConnection();
  File tmpOutputFile=null;
  try {
    tmpOutputFile=File.createTempFile(sqlFile,"tmp");
    InputStream sqlFileInputStream=fileOpener.getResourceAsStream(sqlFile);
    OutputStream outputStream=new FileOutputStream(tmpOutputFile);
    OpenmrsUtil.copyFile(sqlFileInputStream,outputStream);
  }
 catch (  IOException e) {
    throw new CustomChangeException("Unable to copy " + sqlFile + " to file: "+ tmpOutputFile.getAbsolutePath(),e);
  }
  List<String> commands=new ArrayList<String>();
  try {
    commands.add("mysql");
    commands.add("-u" + runtimeProperties.getProperty("connection.username"));
    commands.add("-p" + runtimeProperties.getProperty("connection.password"));
    commands.add("-e" + "source " + tmpOutputFile.getAbsolutePath() + ";");
    commands.add(connection.getCatalog());
  }
 catch (  SQLException e) {
    throw new CustomChangeException("Unable to generate command string for file: " + sqlFile,e);
  }
  StringBuffer output=new StringBuffer();
  Integer exitValue=-1;
  try {
    exitValue=execCmd(tmpOutputFile.getParentFile(),commands.toArray(new String[]{}),output);
  }
 catch (  IOException io) {
    if (io.getMessage().endsWith("not found")) {
      throw new UnsupportedChangeException("Unable to run command: " + commands.get(0) + ".  Make sure that it is on the PATH and then restart your server and try again. "+ " Or run `mysql -u -p -e\"source "+ tmpOutputFile.getAbsolutePath()+ "\"` at the command line",io);
    }
 else {
      throw new UnsupportedChangeException("Error while executing command: '" + commands.get(0) + "'",io);
    }
  }
catch (  Exception e) {
    throw new UnsupportedChangeException("Error while executing command: '" + commands.get(0) + "'",e);
  }
  log.debug("Exec called: " + Arrays.asList(commands));
  if (exitValue != 0) {
    log.error("There was an error while running the " + commands.get(0) + " command.  Command output: "+ output.toString());
    throw new UnsupportedChangeException("There was an error while running the " + commands.get(0) + " command.  Command output: "+ output.toString());
  }
 else {
    log.debug("Output of exec: " + output);
  }
}
