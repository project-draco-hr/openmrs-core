{
  DateFormat ymd=new SimpleDateFormat("yyyy-MM-dd");
  Concept testConcept=Context.getConceptService().getConcept(18);
  Obs obs1=new Obs();
  obs1.setPerson(new Person(8));
  obs1.setConcept(testConcept);
  obs1.setObsDatetime(ymd.parse("2007-01-01"));
  obs1.setValueBoolean(true);
  obs1.setValueDatetime(ymd.parse("2007-01-01"));
  Context.getObsService().saveObs(obs1,null);
  Obs obs2=new Obs();
  obs2.setPerson(new Person(8));
  obs2.setConcept(testConcept);
  obs2.setObsDatetime(ymd.parse("2007-01-05"));
  obs2.setValueBoolean(true);
  obs2.setValueDatetime(ymd.parse("2007-01-05"));
  Context.getObsService().saveObs(obs2,null);
  Obs obs3=new Obs();
  obs3.setPerson(new Person(7));
  obs3.setConcept(testConcept);
  obs3.setObsDatetime(ymd.parse("2007-01-03"));
  obs3.setValueBoolean(true);
  obs3.setValueDatetime(ymd.parse("2007-01-03"));
  Context.getObsService().saveObs(obs3,null);
  Cohort cohort=service.getPatientsHavingDateObs(18,ymd.parse("2006-12-31"),ymd.parse("2007-01-02"));
  assertEquals(1,cohort.size());
  assertTrue(cohort.contains(8));
  Map<Integer,List<Obs>> result=service.getObservations(cohort,testConcept,ymd.parse("2006-12-31"),ymd.parse("2007-01-02"));
  assertEquals(1,result.size());
  assertTrue(result.containsKey(8));
}
