{
  Encounter encounter=new Encounter();
  encounter.setLocation(new Location(1));
  encounter.setEncounterType(new EncounterType(1));
  encounter.setEncounterDatetime(new Date());
  encounter.setPatient(new Patient(2));
  encounter.setCreator(new User(4));
  assertNull(encounter.getVisit());
  GlobalProperty gp=Context.getAdministrationService().getGlobalPropertyObject(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER);
  gp.setPropertyValue("org.openmrs.api.handler.ExistingVisitAssignmentHandler");
  Context.getAdministrationService().saveGlobalProperty(gp);
  Context.getEncounterService().saveEncounter(encounter);
  assertNotNull(encounter.getVisit());
  assertNotNull(encounter.getVisit().getVisitId());
}
