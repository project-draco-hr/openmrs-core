{
  if (!Context.isSessionOpen()) {
    Context.openSession();
  }
  if (useInMemoryDatabase()) {
    if (!skipBaseSetup) {
synchronized (isBaseSetupLock) {
        if (!isBaseSetup) {
          initializeInMemoryDatabase();
          executeDataSet(EXAMPLE_XML_DATASET_PACKAGE_PATH);
          getConnection().commit();
          updateSearchIndex();
          isBaseSetup=true;
        }
      }
      authenticate();
    }
 else {
synchronized (isBaseSetupLock) {
        if (isBaseSetup) {
          deleteAllData();
        }
      }
    }
  }
  Context.clearSession();
}
