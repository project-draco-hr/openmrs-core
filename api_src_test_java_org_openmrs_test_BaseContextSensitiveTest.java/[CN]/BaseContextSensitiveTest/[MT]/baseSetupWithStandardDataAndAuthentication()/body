{
  if (!Context.isSessionOpen()) {
    Context.openSession();
  }
  if (useInMemoryDatabase()) {
    if (!skipBaseSetup) {
      if (!isBaseSetup) {
        initializeInMemoryDatabase();
        executeDataSet(EXAMPLE_XML_DATASET_PACKAGE_PATH);
        getConnection().commit();
        updateSearchIndex();
        isBaseSetup=true;
      }
      authenticate();
    }
 else {
      if (isBaseSetup) {
        deleteAllData();
      }
    }
  }
  Context.clearSession();
}
