{
  Encounter encounter=(Encounter)obj;
  try {
    if (Context.isAuthenticated()) {
      Context.addProxyPrivilege(OpenmrsConstants.PRIV_VIEW_USERS);
      Context.addProxyPrivilege(OpenmrsConstants.PRIV_VIEW_PATIENTS);
      if (StringUtils.hasText(request.getParameter("patientId")))       encounter.setPatient(Context.getPatientService().getPatient(Integer.valueOf(request.getParameter("patientId"))));
      if (StringUtils.hasText(request.getParameter("providerId")))       encounter.setProvider(Context.getPersonService().getPerson(Integer.valueOf(request.getParameter("providerId"))));
      if (encounter.isVoided())       ValidationUtils.rejectIfEmptyOrWhitespace(errors,"voidReason","error.null");
      ValidationUtils.rejectIfEmptyOrWhitespace(errors,"patient","error.null");
      ValidationUtils.rejectIfEmptyOrWhitespace(errors,"provider","error.null");
      ValidationUtils.rejectIfEmptyOrWhitespace(errors,"encounterDatetime","error.null");
    }
  }
  finally {
    Context.removeProxyPrivilege(OpenmrsConstants.PRIV_VIEW_USERS);
    Context.removeProxyPrivilege(OpenmrsConstants.PRIV_VIEW_PATIENTS);
  }
  return super.processFormSubmission(request,reponse,encounter,errors);
}
