{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String[] cdList=request.getParameterValues("conceptDatatypeId");
    ConceptService cs=Context.getConceptService();
    StringBuilder success=new StringBuilder("");
    StringBuilder error=new StringBuilder();
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String deleted=msa.getMessage("general.deleted");
    String notDeleted=msa.getMessage("general.cannot.delete");
    for (    String cd : cdList) {
      try {
        cs.purgeConceptDatatype(cs.getConceptDatatype(Integer.valueOf(cd)));
        if (!success.toString().equals(""))         success.append("<br/>");
        success.append(cd);
        success.append(" ");
        success.append(deleted);
      }
 catch (      APIException e) {
        log.warn("Error deleting concept datatype",e);
        if (!error.equals(""))         error.append("<br/>");
        error.append(cd).append(" ").append(notDeleted);
      }
    }
    view=getSuccessView();
    if (!success.toString().equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success.toString());
    if (!error.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error.toString());
  }
  return new ModelAndView(new RedirectView(view));
}
