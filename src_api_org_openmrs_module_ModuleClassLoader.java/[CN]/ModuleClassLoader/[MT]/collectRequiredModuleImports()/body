{
  Map<String,Module> publicImportsMap=new WeakHashMap<String,Module>();
  for (  String moduleId : ModuleConstants.REQUIRED_MODULES.keySet()) {
    Module moduleClassLoader=ModuleFactory.getModuleById(moduleId);
    if (moduleClassLoader == null)     throw new APIException("Should not be here.  All 'required' modules by the api should be started and their classloaders should be available");
    publicImportsMap.put(moduleId,moduleClassLoader);
  }
  for (  String requiredPackage : getModule().getRequiredModules()) {
    Module requiredModule=ModuleFactory.getModuleByPackage(requiredPackage);
    if (ModuleFactory.isModuleStarted(requiredModule)) {
      publicImportsMap.put(requiredModule.getModuleId(),requiredModule);
    }
  }
  requiredModules=(Module[])publicImportsMap.values().toArray(new Module[publicImportsMap.size()]);
}
