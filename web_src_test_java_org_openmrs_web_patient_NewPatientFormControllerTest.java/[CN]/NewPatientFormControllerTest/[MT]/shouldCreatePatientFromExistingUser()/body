{
  PatientService ps=Context.getPatientService();
  Assert.assertNull(ps.getPatient(3));
  Assert.assertNull(ps.getPatient(4));
  executeDataSet(CONTROLLER_PATIENTS_DATA);
  NewPatientFormController controller=new NewPatientFormController();
  controller.setApplicationContext(applicationContext);
  controller.setSuccessView("patientDashboard.form");
  controller.setFormView("newPatient.form");
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/admin/patients/newPatient.form?patientId=3");
  request.setSession(new MockHttpSession(null));
  HttpServletResponse response=new MockHttpServletResponse();
  ModelAndView initialPageLoad=controller.handleRequest(request,response);
  request.setMethod("POST");
  request.addParameter("patientId","3");
  request.addParameter("name.givenName","John");
  request.addParameter("name.familyName","Doe");
  request.addParameter("identifier","12345678");
  request.addParameter("identifierType","1");
  request.addParameter("location","2");
  request.addParameter("preferred","1");
  request.addParameter("gender","F");
  request.addParameter("birthdate","05/05/1959");
  request.addParameter("birthdateEstimated","0");
  ModelAndView modelAndView=controller.handleRequest(request,response);
  assertEquals(RedirectView.class,modelAndView.getView().getClass());
  RedirectView redirectView=(RedirectView)modelAndView.getView();
  assertTrue(redirectView.getUrl().startsWith("patientDashboard.form"));
  Assert.assertNotNull(ps.getPatient(3));
  Assert.assertNull(ps.getPatient(4));
}
