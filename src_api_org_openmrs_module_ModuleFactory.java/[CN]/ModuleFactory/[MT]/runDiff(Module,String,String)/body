{
  AdministrationService as=Context.getAdministrationService();
  String key=module.getModuleId() + ".database_version";
  String select="select property_value from global_property where property = '" + key + "'";
  List<List<Object>> results=as.executeSQL(select,true);
  boolean executeSQL=false;
  if (results.size() > 0) {
    for (    List<Object> row : results) {
      String column=(String)row.get(0);
      log.debug("version:column " + version + ":"+ column);
      log.debug("compare: " + ModuleUtil.compareVersion(version,column));
      if (ModuleUtil.compareVersion(version,column) > 0)       executeSQL=true;
    }
  }
 else {
    executeSQL=true;
  }
  if (executeSQL) {
    log.debug("Executing sql: " + sql);
    String[] sqlStatements=sql.split(";");
    for (    String sqlStatement : sqlStatements) {
      if (sqlStatement.trim().length() > 0)       as.executeSQL(sqlStatement,false);
    }
    try {
      Context.addProxyPrivilege(OpenmrsConstants.PRIV_MANAGE_GLOBAL_PROPERTIES);
      String description="DO NOT MODIFY.  Current database version number for the " + module.getModuleId() + " module.";
      GlobalProperty gp=as.getGlobalPropertyObject(key);
      System.out.println("Global property key is " + key);
      if (gp == null) {
        gp=new GlobalProperty(key,version,description);
        System.out.println("Global property not found!!");
      }
 else {
        gp.setDescription(description);
        gp.setPropertyValue(version);
      }
      if (gp != null && !(gp.getPropertyValue().equals(version)))       as.saveGlobalProperty(gp);
    }
  finally {
      Context.removeProxyPrivilege(OpenmrsConstants.PRIV_MANAGE_GLOBAL_PROPERTIES);
    }
  }
}
