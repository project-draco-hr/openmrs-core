{
  initializeInMemoryDatabase();
  executeDataSet("org/openmrs/test/reporting/export/include/DataExportTest-patients.xml");
  authenticate();
  DataExportReportObject export=new DataExportReportObject();
  export.setName("Data Export Keys");
  SimpleColumn patientId=new SimpleColumn();
  patientId.setColumnName("PATIENT_ID");
  patientId.setReturnValue("$!{fn.patientId}");
  export.getColumns().add(patientId);
  SimpleColumn dataExportKey=new SimpleColumn();
  dataExportKey.setColumnName("bobkey");
  dataExportKey.setReturnValue("$!{bob}");
  export.getColumns().add(dataExportKey);
  Cohort patients=new Cohort();
  patients.addMember(2);
  DataExportUtil.putDataExportKey("bob","joe");
  DataExportUtil.generateExport(export,patients,"\t",null);
  File exportFile=DataExportUtil.getGeneratedFile(export);
  String expectedOutput="PATIENT_ID	bobkey\n2	joe\n";
  String output=OpenmrsUtil.getFileAsString(exportFile);
  exportFile.delete();
  assertEquals("The output is not right.",expectedOutput,output);
}
