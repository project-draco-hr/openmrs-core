{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  String view=getFormView();
  if (context != null && context.isAuthenticated()) {
    try {
      if (request instanceof MultipartHttpServletRequest) {
        MultipartHttpServletRequest multipartRequest=(MultipartHttpServletRequest)request;
        MultipartFile xsnFile=multipartRequest.getFile("xsnFile");
        if (xsnFile != null && !xsnFile.isEmpty()) {
          PublishInfoPath.publishXSN(xsnFile.getInputStream(),context);
          httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,"FormEntry.xsn.saved");
        }
      }
    }
 catch (    IOException e) {
      log.error(e);
      errors.reject(e.getMessage());
      httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"FormEntry.xsn.not.saved");
      return showForm(request,response,errors);
    }
    view=getSuccessView();
    return new ModelAndView(new RedirectView(view));
  }
  httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"FormEntry.xsn.not.saved");
  return showForm(request,response,errors);
}
