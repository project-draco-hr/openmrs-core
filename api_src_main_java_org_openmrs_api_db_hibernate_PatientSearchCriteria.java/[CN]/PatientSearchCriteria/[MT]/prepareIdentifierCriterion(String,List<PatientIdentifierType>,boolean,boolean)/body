{
  Conjunction conjuction=Restrictions.conjunction();
  criteria.createAlias("identifiers","ids");
  conjuction.add(Restrictions.eq("ids.voided",false));
  if (identifier != null) {
    if (matchIdentifierExactly) {
      conjuction.add(Restrictions.eq("ids.identifier",identifier).ignoreCase());
    }
 else {
      AdministrationService adminService=Context.getAdministrationService();
      String regex=adminService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_REGEX,"");
      String patternSearch=adminService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_SEARCH_PATTERN,"");
      if (Pattern.matches("^\\^.{1}\\*.*$",regex)) {
        identifier=removePadding(identifier,regex);
      }
      if (StringUtils.hasLength(patternSearch)) {
        conjuction.add(splitAndGetSearchPattern(identifier,patternSearch));
      }
 else       if (regex.equals("") || HibernateUtil.isHSQLDialect(sessionFactory)) {
        conjuction.add(getCriterionForSimpleSearch(identifier,adminService));
      }
 else {
        regex=replaceSearchString(regex,identifier);
        conjuction.add(Restrictions.sqlRestriction("identifier regexp ?",regex,StandardBasicTypes.STRING));
      }
    }
  }
  if (identifierTypes.size() > 0) {
    criteria.add(Restrictions.in("ids.identifierType",identifierTypes));
  }
  return conjuction;
}
