{
  if (context != null) {
    if (StringUtils.hasText(text)) {
      ConceptService cs=context.getConceptService();
      String[] conceptIds=text.split(" ");
      List<String> requestConceptIds=new Vector<String>();
      Set<ConceptAnswer> newAnswers=new HashSet<ConceptAnswer>();
      for (      String id : conceptIds) {
        id=id.trim();
        if (!id.equals("") && !requestConceptIds.contains(id))         requestConceptIds.add(id);
      }
      Collection<ConceptAnswer> originalConceptAnswers=(Collection<ConceptAnswer>)getValue();
      Collection<ConceptAnswer> deletedConceptAnswers=new HashSet<ConceptAnswer>();
      for (      ConceptAnswer origConceptAnswer : originalConceptAnswers) {
        boolean answerDeleted=true;
        for (        String conceptId : requestConceptIds) {
          Integer id=getConceptId(conceptId);
          Integer drugId=getDrugId(conceptId);
          if (id.equals(origConceptAnswer.getAnswerConcept().getConceptId())) {
            if ((drugId == null && origConceptAnswer.getAnswerDrug() == null) || drugId.equals(origConceptAnswer.getAnswerDrug().getDrugId()))             answerDeleted=false;
          }
        }
        if (answerDeleted)         deletedConceptAnswers.add(origConceptAnswer);
      }
      for (      ConceptAnswer conceptAnswer : deletedConceptAnswers) {
        originalConceptAnswers.remove(conceptAnswer);
      }
      for (      String conceptId : requestConceptIds) {
        Integer id=getConceptId(conceptId);
        Integer drugId=getDrugId(conceptId);
        boolean newAnswerConcept=true;
        for (        ConceptAnswer origConceptAnswer : originalConceptAnswers) {
          if (id.equals(origConceptAnswer.getAnswerConcept().getConceptId())) {
            if ((drugId == null && origConceptAnswer.getAnswerDrug() == null) || drugId.equals(origConceptAnswer.getAnswerDrug().getDrugId()))             newAnswerConcept=false;
          }
        }
        if (newAnswerConcept) {
          Concept answer=cs.getConcept(id);
          Drug drug=null;
          if (drugId != null)           drug=cs.getDrug(drugId);
          ConceptAnswer ac=new ConceptAnswer(answer,drug);
          originalConceptAnswers.add(ac);
        }
      }
      log.debug("originalConceptAnswers.getConceptId(): ");
      for (      ConceptAnswer a : originalConceptAnswers)       log.debug("id: " + a.getAnswerConcept().getConceptId());
      log.debug("requestConceptIds: ");
      for (      String i : requestConceptIds)       log.debug("id: " + i);
      setValue(originalConceptAnswers);
    }
 else {
      setValue(null);
    }
  }
}
