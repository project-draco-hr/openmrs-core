{
  MessageService ms=getServiceContext().getMessageService();
  if (ms == null) {
    try {
      MessagePreparator preparator=getMessagePreparator();
      MessageSender sender=getMessageSender();
      ms=new MessageServiceImpl();
      ms.setMessageSender(sender);
      ms.setMessagePreparator(preparator);
    }
 catch (    Exception e) {
      log.error("Unable to create message service due to : " + e.getMessage(),e);
    }
  }
  return ms;
}
