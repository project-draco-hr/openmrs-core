{
  MessageSourceService mss=Context.getMessageSourceService();
  Locale locale=Context.getLocale();
  StringBuffer ret=new StringBuffer();
  if (question == null) {
    if (getValue() != null) {
      ret.append(mss.getMessage("reporting.patientsWith") + " " + timeModifier+ " "+ mss.getMessage("reporting.obsWithValue")+ " "+ ((Concept)value).getName().getName());
    }
 else {
      ret.append(mss.getMessage("reporting.qtnNValNull"));
    }
  }
 else {
    ret.append(mss.getMessage("reporting.patientsWith")).append(" ");
    ret.append(timeModifier).append(" ");
    ConceptName questionName=question.getName(locale,false);
    if (questionName != null) {
      ret.append(questionName);
    }
 else {
      question=Context.getConceptService().getConcept(question.getConceptId());
      if (question != null) {
        questionName=question.getName(locale,false);
        ret.append(questionName);
      }
 else {
        ret.append(mss.getMessage("reporting.concept"));
      }
    }
    if (value != null && modifier != null) {
      ret.append(" ").append(modifier.getSqlRepresentation()).append(" ");
      if (value instanceof Concept) {
        ret.append(((Concept)value).getName(locale));
      }
 else {
        ret.append(value);
      }
    }
  }
  if (withinLastDays != null || withinLastMonths != null) {
    if (withinLastMonths != null) {
      ret.append(" ").append(mss.getMessage("reporting.withinLastMonths",new Object[]{withinLastMonths},locale));
    }
    if (withinLastDays != null) {
      ret.append(" ").append(mss.getMessage("reporting.withinLastDays",new Object[]{withinLastDays},locale));
    }
  }
  if (untilDaysAgo != null || untilMonthsAgo != null) {
    if (untilMonthsAgo != null) {
      ret.append(" ").append(mss.getMessage("reporting.untilMonthsAgo",new Object[]{untilMonthsAgo},locale));
    }
    if (untilDaysAgo != null) {
      ret.append(" ").append(mss.getMessage("reporting.untilDaysAgo",new Object[]{untilDaysAgo},locale));
    }
  }
  DateFormat df=DateFormat.getDateInstance(DateFormat.SHORT,Context.getLocale());
  if (sinceDate != null) {
    ret.append(" ").append(mss.getMessage("reporting.since",new Object[]{df.format(sinceDate)},locale));
  }
  if (untilDate != null) {
    ret.append(" ").append(mss.getMessage("reporting.until",new Object[]{df.format(untilDate)},locale));
  }
  return ret.toString();
}
