{
  ComplexData complexData=obs.getComplexData();
  if (complexData == null) {
    log.error("Cannot save complex data where obsId=" + obs.getObsId() + " because its ComplexData is null.");
    return obs;
  }
  BufferedWriter fout=null;
  try {
    File outfile=getOutputFileToWrite(obs);
    fout=new BufferedWriter(new FileWriter(outfile));
    Reader tempRd=null;
    Object data=obs.getComplexData().getData();
    if (data instanceof char[]) {
      fout.write((char[])data);
    }
 else     if (Reader.class.isAssignableFrom(data.getClass())) {
      try {
        tempRd=new BufferedReader((Reader)data);
        while (true) {
          int character=tempRd.read();
          if (character == -1) {
            break;
          }
          fout.write(character);
        }
      }
 catch (      IOException e) {
        throw new APIException("Obs.error.unable.convert.complex.data",new Object[]{"Reader"},e);
      }
    }
    obs.setValueComplex(outfile.getName() + " file |" + outfile.getName());
    obs.setComplexData(null);
  }
 catch (  IOException ioe) {
    throw new APIException("Obs.error.trying.write.complex",null,ioe);
  }
 finally {
    try {
      fout.close();
    }
 catch (    Exception e) {
    }
  }
  return obs;
}
