{
  executeDataSet(CONTROLLER_PATIENTS_DATA);
  executeDataSet("org/openmrs/web/test/patient/include/NewPatientFormControllerTest-addRelationship.xml");
  PatientService ps=Context.getPatientService();
  NewPatientFormController controller=new NewPatientFormController();
  controller.setApplicationContext(applicationContext);
  controller.setSuccessView("patientDashboard.form");
  controller.setFormView("newPatient.form");
  controller.setSessionForm(true);
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/admin/patients/newPatient.form?patientId=2");
  request.setSession(new MockHttpSession(null));
  HttpServletResponse response=new MockHttpServletResponse();
  controller.handleRequest(request,response);
  request.setMethod("POST");
  request.addParameter("patientId","2");
  request.addParameter("name.givenName","Horatio");
  request.addParameter("name.middleName","Test");
  request.addParameter("name.familyName","Hornblower");
  request.addParameter("identifier","1234");
  request.addParameter("identifierType","1");
  request.addParameter("location","1");
  request.addParameter("preferred","1");
  request.addParameter("gender","F");
  request.addParameter("birthdate","05/05/1959");
  request.addParameter("birthdateEstimated","0");
  request.addParameter("tribe","");
  request.addParameter("1a","3");
  request.addParameter("1","1234");
  Context.getPersonService().getPersonAttributeTypes(PERSON_TYPE.PATIENT,ATTR_VIEW_TYPE.VIEWING);
  controller.handleRequest(request,response);
  Patient patient=ps.getPatient(2);
  assertNotNull(patient);
  List<Relationship> relationships=Context.getPersonService().getRelationships(null,patient,Context.getPersonService().getRelationshipType(1));
  assertEquals(1,relationships.size());
  assertEquals(new Person(3),relationships.get(0).getPersonA());
}
