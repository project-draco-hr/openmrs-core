{
  Object result=super.invoke(invocation);
  Class<?> targetClass=(invocation.getThis() != null ? AopUtils.getTargetClass(invocation.getThis()) : null);
  final TransactionAttribute txAttr=getTransactionAttributeSource().getTransactionAttribute(invocation.getMethod(),targetClass);
  if (txAttr != null && !txAttr.isReadOnly()) {
    if (!Context.class.equals(targetClass) && !invocation.getMethod().getName().equals("flushSession")) {
      Context.flushSession();
    }
  }
  return result;
}
