{
  final DrugOrder orderToDiscontinue=(DrugOrder)orderService.getOrder(5);
  assertTrue(OrderUtil.isOrderActive(orderToDiscontinue,null));
  Drug discontinuationOrderDrug=new Drug();
  discontinuationOrderDrug.setConcept(orderToDiscontinue.getConcept());
  discontinuationOrderDrug=Context.getConceptService().saveDrug(discontinuationOrderDrug);
  assertNotEquals(discontinuationOrderDrug,orderToDiscontinue.getDrug());
  assertNotNull(orderToDiscontinue.getDrug());
  DrugOrder order=new DrugOrder();
  order.setDrug(discontinuationOrderDrug);
  order.setOrderType(orderService.getOrderTypeByName("Drug order"));
  order.setAction(Order.Action.DISCONTINUE);
  order.setOrderReasonNonCoded("Discontinue this");
  order.setPatient(orderToDiscontinue.getPatient());
  order.setConcept(orderToDiscontinue.getConcept());
  order.setOrderer(orderToDiscontinue.getOrderer());
  order.setCareSetting(orderToDiscontinue.getCareSetting());
  order.setStartDate(new Date());
  orderService.saveOrder(order,null);
  Assert.assertNotNull("previous order should be discontinued",orderToDiscontinue.getDateStopped());
}
