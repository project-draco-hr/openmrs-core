{
  HL7InError hl7InError=new HL7InError(hl7InQueue);
  hl7InError.setError(error);
  if (cause == null)   hl7InError.setErrorDetails("");
 else {
    StringWriter sw=new StringWriter();
    PrintWriter pw=new PrintWriter(sw,true);
    cause.printStackTrace(pw);
    pw.flush();
    sw.flush();
    hl7InError.setErrorDetails(OpenmrsUtil.shortenedStackTrace(sw.toString()));
  }
  Context.getHL7Service().saveHL7InError(hl7InError);
  Context.getHL7Service().purgeHL7InQueue(hl7InQueue);
  log.error(error,cause);
}
