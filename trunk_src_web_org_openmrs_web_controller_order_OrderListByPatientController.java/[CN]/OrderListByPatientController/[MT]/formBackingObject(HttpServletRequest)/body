{
  List<DrugOrder> orderList=new Vector<DrugOrder>();
  Integer patientId=ServletRequestUtils.getIntParameter(request,"patientId");
  boolean showAll=ServletRequestUtils.getBooleanParameter(request,"showAll",false);
  System.err.println("pid is " + patientId);
  if (Context.isAuthenticated()) {
    if (patientId != null) {
      this.setFormView("/admin/orders/orderListByPatient");
      PatientService ps=Context.getPatientService();
      Patient p=ps.getPatient(patientId);
      if (p != null) {
        OrderService os=Context.getOrderService();
        orderList=os.getDrugOrdersByPatient(p);
      }
 else {
        log.error("Could not get a patient corresponding to patientId [" + patientId + "], thus could not get drug orders.");
        throw new ServletException();
      }
    }
 else {
      if (showAll) {
        this.setFormView("/admin/orders/orderDrugList");
        OrderService os=Context.getOrderService();
        orderList=os.getDrugOrders();
      }
 else {
        this.setFormView("/admin/orders/choosePatient");
      }
    }
  }
  return orderList;
}
