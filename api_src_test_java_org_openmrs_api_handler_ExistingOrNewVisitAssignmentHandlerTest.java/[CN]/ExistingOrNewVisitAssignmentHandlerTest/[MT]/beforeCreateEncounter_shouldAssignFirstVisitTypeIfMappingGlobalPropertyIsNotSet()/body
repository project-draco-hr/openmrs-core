{
  Encounter encounter=Context.getEncounterService().getEncounter(1);
  Assert.assertNull(encounter.getVisit());
  Calendar calendar=Calendar.getInstance();
  calendar.setTime(encounter.getEncounterDatetime());
  calendar.set(Calendar.YEAR,1900);
  encounter.setEncounterDatetime(calendar.getTime());
  new ExistingOrNewVisitAssignmentHandler().beforeCreateEncounter(encounter);
  Assert.assertNotNull(encounter.getVisit());
  Visit visit=encounter.getVisit();
  encounter.setVisit(null);
  Context.getVisitService().saveVisit(visit);
  encounter.setVisit(visit);
  Assert.assertEquals(Context.getVisitService().getAllVisitTypes().get(0),encounter.getVisit().getVisitType());
}
