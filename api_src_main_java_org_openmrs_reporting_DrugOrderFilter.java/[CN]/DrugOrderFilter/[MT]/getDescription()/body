{
  MessageSourceService mss=Context.getMessageSourceService();
  Locale locale=Context.getLocale();
  DateFormat df=DateFormat.getDateInstance(DateFormat.SHORT,Context.getLocale());
  StringBuilder ret=new StringBuilder();
  boolean currentlyCase=getWithinLastDays() != null && getWithinLastDays() == 0 && (getWithinLastMonths() == null || getWithinLastMonths() == 0);
  if (currentlyCase) {
    ret.append(mss.getMessage("reporting.patientCurrently")).append(" ");
  }
 else {
    ret.append(mss.getMessage("reporting.patients")).append(" ");
  }
  if (getDrugListToUse() == null || getDrugListToUse().isEmpty()) {
    if (getAnyOrAll() == GroupMethod.NONE) {
      ret.append(currentlyCase ? mss.getMessage("reporting.takingNoDrugs") : mss.getMessage("reporting.whoNeverTakeDrug"));
    }
 else {
      ret.append(currentlyCase ? mss.getMessage("reporting.takingAnyDrugs") : mss.getMessage("reporting.everTakingAnyDrugs"));
    }
  }
 else {
    if (getDrugListToUse().size() == 1) {
      if (getAnyOrAll() == GroupMethod.NONE) {
        ret.append(mss.getMessage("reporting.notTaking")).append(" ");
      }
 else {
        ret.append(mss.getMessage("reporting.taking").toLowerCase()).append(" ");
      }
      ret.append(getDrugListToUse().get(0).getName());
    }
 else {
      ret.append(mss.getMessage("reporting.taking").toLowerCase()).append(" ").append(getAnyOrAll()).append(mss.getMessage("reporting.of")).append(" [");
      for (Iterator<Drug> i=getDrugListToUse().iterator(); i.hasNext(); ) {
        ret.append(i.next().getName());
        if (i.hasNext()) {
          ret.append(" , ");
        }
      }
      ret.append("]");
    }
  }
  Integer within_last_days=getWithinLastDays();
  Integer within_last_months=getWithinLastMonths();
  if (!currentlyCase) {
    if (within_last_days != null || within_last_months != null) {
      if (within_last_months != null)       ret.append(" ").append(mss.getMessage("reporting.WithinTheLastMonths",new Object[]{within_last_months},locale));
      if (within_last_days != null)       ret.append(" ").append(mss.getMessage("reporting.WithinTheLastDays",new Object[]{within_last_days},locale));
    }
  }
  if (getSinceDate() != null) {
    ret.append(" ").append(mss.getMessage("reporting.since",new Object[]{df.format(getSinceDate())},locale));
  }
  if (getUntilDate() != null) {
    ret.append(" ").append(mss.getMessage("reporting.until",new Object[]{df.format(getUntilDate())},locale));
  }
  return ret.toString();
}
