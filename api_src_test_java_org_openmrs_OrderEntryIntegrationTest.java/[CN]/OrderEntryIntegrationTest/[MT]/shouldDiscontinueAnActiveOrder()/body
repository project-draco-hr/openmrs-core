{
  executeDataSet(ORDER_ENTRY_DATASET_XML);
  executeDataSet("org/openmrs/api/include/OrderServiceTest-discontinueReason.xml");
  Order firstOrderToDiscontinue=orderService.getOrder(3);
  Encounter encounter=Context.getEncounterService().getEncounter(3);
  assertTrue(OrderUtil.isOrderActive(firstOrderToDiscontinue,null));
  Patient patient=firstOrderToDiscontinue.getPatient();
  int ordersCount=orderService.getActiveOrders(patient,null,null,null).size();
  Concept discontinueReason=Context.getConceptService().getConcept(1);
  Order discontinuationOrder1=orderService.discontinueOrder(firstOrderToDiscontinue,discontinueReason,null,null,encounter);
  assertEquals(firstOrderToDiscontinue,discontinuationOrder1.getPreviousOrder());
  Order secondOrderToDiscontinue=orderService.getOrder(5);
  assertEquals(patient,secondOrderToDiscontinue.getPatient());
  assertTrue(OrderUtil.isOrderActive(secondOrderToDiscontinue,null));
  Order discontinuationOrder2=orderService.discontinueOrder(secondOrderToDiscontinue,"Testing",null,null,encounter);
  assertEquals(secondOrderToDiscontinue,discontinuationOrder2.getPreviousOrder());
  Order thirdOrderToDiscontinue=orderService.getOrder(7);
  assertTrue(OrderUtil.isOrderActive(thirdOrderToDiscontinue,null));
  Order discontinuationOrder=thirdOrderToDiscontinue.cloneForDiscontinuing();
  discontinuationOrder.setOrderer(providerService.getProvider(1));
  orderService.saveOrder(discontinuationOrder,null);
  List<Order> activeOrders=orderService.getActiveOrders(patient,null,null,null);
  assertEquals(ordersCount - 3,activeOrders.size());
  assertFalse(activeOrders.contains(firstOrderToDiscontinue));
  assertFalse(activeOrders.contains(secondOrderToDiscontinue));
  assertFalse(activeOrders.contains(thirdOrderToDiscontinue));
}
