{
  OptionsForm opts=new OptionsForm();
  if (Context.isAuthenticated()) {
    User user=Context.getAuthenticatedUser();
    Map<String,String> props=user.getUserProperties();
    opts.setDefaultLocation(props.get(OpenmrsConstants.USER_PROPERTY_DEFAULT_LOCATION));
    opts.setDefaultLocale(props.get(OpenmrsConstants.USER_PROPERTY_DEFAULT_LOCALE));
    opts.setProficientLocales(props.get(OpenmrsConstants.USER_PROPERTY_PROFICIENT_LOCALES));
    opts.setShowRetiredMessage(new Boolean(props.get(OpenmrsConstants.USER_PROPERTY_SHOW_RETIRED)));
    opts.setVerbose(new Boolean(props.get(OpenmrsConstants.USER_PROPERTY_SHOW_VERBOSE)));
    opts.setUsername(user.getUsername());
    opts.setSecretQuestionNew(user.getSecretQuestion());
    PersonName personName;
    if (user.getPersonName() != null) {
      personName=PersonName.newInstance(user.getPersonName());
      personName.setPersonNameId(null);
    }
 else     personName=new PersonName();
    opts.setPersonName(personName);
    opts.setNotification(props.get(OpenmrsConstants.USER_PROPERTY_NOTIFICATION));
    opts.setNotificationAddress(props.get(OpenmrsConstants.USER_PROPERTY_NOTIFICATION_ADDRESS));
  }
  return opts;
}
