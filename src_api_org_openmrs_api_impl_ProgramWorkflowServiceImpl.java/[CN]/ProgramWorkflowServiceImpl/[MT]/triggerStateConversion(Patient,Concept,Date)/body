{
  if (patient == null)   throw new APIException("Attempting to convert state of an invalid patient");
  if (trigger == null)   throw new APIException("Attempting to convert state for a patient without a valid trigger concept");
  if (dateConverted == null)   throw new APIException("Invalid date for converting patient state");
  for (  PatientProgram patientProgram : getPatientPrograms(patient,null,null,null,null,null,false)) {
    Set<ProgramWorkflow> workflows=patientProgram.getProgram().getWorkflows();
    for (    ProgramWorkflow workflow : workflows) {
      ProgramWorkflowState currentState=patientProgram.getCurrentState(workflow).getState();
      ProgramWorkflowState transitionState=workflow.getState(trigger);
      if (transitionState != null && workflow.isLegalTransition(currentState,transitionState)) {
        patientProgram.transitionToState(transitionState,dateConverted);
        log.info("State Conversion Triggered: patientProgram=" + patientProgram + " transition from "+ currentState+ " to "+ transitionState+ " on "+ dateConverted);
      }
    }
  }
}
