{
  Context.requirePrivilege(PrivilegeConstants.MANAGE_ENCOUNTER_VISITS);
  String encounterVisitHandler=administrationService.getGlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER);
  String enableVisits=administrationService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_ENABLE_VISITS,Boolean.FALSE.toString());
  EncounterVisitHandlerForm form=new EncounterVisitHandlerForm();
  form.setEnableVisits(Boolean.valueOf(enableVisits));
  for (  EncounterVisitHandler visitHandler : getEncounterVisitHandlers()) {
    if (visitHandler.getClass().getName().equals(encounterVisitHandler)) {
      form.setEncounterVisitHandler(visitHandler.getClass().getName());
      break;
    }
  }
  model.addAttribute(ENCOUNTER_VISIT_HANDLER_FORM,form);
}
