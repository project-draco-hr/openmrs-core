{
  Context.requirePrivilege(PrivilegeConstants.MANAGE_ENCOUNTER_VISITS);
  if (errors.hasErrors()) {
    return;
  }
  GlobalProperty gpEnableVisits=new GlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_ENABLE_VISITS,Boolean.toString(form.isEnableVisits()));
  administrationService.saveGlobalProperty(gpEnableVisits);
  if (form.isEnableVisits()) {
    String type=form.getEncounterVisitHandler();
    GlobalProperty gpEncounterVisitHandler=new GlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER,type);
    administrationService.saveGlobalProperty(gpEncounterVisitHandler);
  }
 else {
    form.setEncounterVisitHandler(administrationService.getGlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER));
  }
}
