{
  List<String> types=(List<String>)typeArray;
  String key=OpenmrsUtil.join(types,",") + "|" + attr;
  if (patientFirstEncounterMap.containsKey(key)) {
    return patientFirstEncounterMap.get(key).get(getPatientId());
  }
  log.debug("getting first encounters for type: " + key);
  List<EncounterType> encounterTypes=new Vector<EncounterType>();
  for (  String typeName : types) {
    EncounterType type=null;
    try {
      type=encounterService.getEncounterType(Integer.valueOf(typeName));
    }
 catch (    Exception e) {
    }
    if (type == null) {
      type=encounterService.getEncounterType(typeName);
    }
    if (type != null) {
      encounterTypes.add(type);
    }
  }
  Map<Integer,Object> encounterMap=patientSetService.getFirstEncounterAttrsByType(getPatientSetIfNotAllPatients(),encounterTypes,attr);
  patientFirstEncounterMap.put(key,encounterMap);
  return encounterMap.get(getPatientId());
}
