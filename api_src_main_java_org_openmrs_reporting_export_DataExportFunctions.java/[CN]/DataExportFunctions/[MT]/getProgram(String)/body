{
  Map<Integer,PatientProgram> patientIdProgramMap;
  if (programMap.containsKey(programIdOrName)) {
    patientIdProgramMap=programMap.get(programIdOrName);
  }
 else {
    Program program=null;
    try {
      Integer programId=Integer.parseInt(programIdOrName);
      program=Context.getProgramWorkflowService().getProgram(programId);
    }
 catch (    NumberFormatException e) {
    }
    if (program == null) {
      program=Context.getProgramWorkflowService().getProgramByName(programIdOrName);
    }
    patientIdProgramMap=patientSetService.getPatientPrograms(getPatientSetIfNotAllPatients(),program);
    programMap.put(programIdOrName,patientIdProgramMap);
  }
  return patientIdProgramMap.get(patientId);
}
