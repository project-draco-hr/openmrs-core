{
  String handlerGlobalValue=Context.getAdministrationService().getGlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER,null);
  if (StringUtils.isBlank(handlerGlobalValue)) {
    return null;
  }
  EncounterVisitHandler handler=null;
  String namePrefix=OpenmrsConstants.REGISTERED_COMPONENT_NAME_PREFIX;
  if (handlerGlobalValue.startsWith(namePrefix)) {
    String beanName=handlerGlobalValue.substring(namePrefix.length());
    handler=Context.getRegisteredComponent(beanName,EncounterVisitHandler.class);
  }
 else {
    Object instance;
    try {
      instance=OpenmrsClassLoader.getInstance().loadClass(handlerGlobalValue).newInstance();
    }
 catch (    Exception ex) {
      throw new APIException("Failed to instantiate assignment handler object for class class: " + handlerGlobalValue,ex);
    }
    if (instance instanceof EncounterVisitHandler) {
      handler=(EncounterVisitHandler)instance;
    }
 else {
      throw new APIException("The registered visit assignment handler should implement the EncounterVisitHandler interface");
    }
  }
  return handler;
}
