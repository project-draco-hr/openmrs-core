{
  Properties macros=getReportXmlMacros();
  if (macros != null && macros.size() > 0) {
    log.debug("XML Before macros: " + input);
    String prefix=macros.getProperty("macroPrefix","");
    String suffix=macros.getProperty("macroSuffix","");
    while (true) {
      String replacement=input;
      for (      Map.Entry<Object,Object> e : macros.entrySet()) {
        String key=prefix + e.getKey() + suffix;
        String value=e.getValue() == null ? "" : e.getValue().toString();
        log.debug("Trying to replace " + key + " with "+ value);
        replacement=replacement.replace(key,(String)e.getValue());
      }
      if (input.equals(replacement)) {
        log.debug("Macro expansion complete.");
        break;
      }
      input=replacement;
      log.debug("XML Exploded to: " + input);
    }
  }
  return input;
}
