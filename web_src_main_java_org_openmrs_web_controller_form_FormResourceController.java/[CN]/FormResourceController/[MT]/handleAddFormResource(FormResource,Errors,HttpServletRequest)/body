{
  HttpSession session=request.getSession();
  try {
    Object value=WebAttributeUtil.getValue(request,resource,"resourceValue");
    resource.setValue(value);
  }
 catch (  Exception ex) {
    errors.rejectValue("value","error.general");
  }
  if (errors.hasErrors()) {
    throw new RuntimeException("Error handling not yet implemented");
  }
 else {
    try {
      Context.getFormService().saveFormResource(resource);
    }
 catch (    InvalidFileTypeException ex) {
      log.error(ex.getMessage(),ex);
      session.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"error.file.upload.expected.text.file");
      return "redirect:addFormResource.form?formId=" + resource.getForm().getId() + "&datatype="+ resource.getDatatypeClassname()+ "&handler="+ resource.getPreferredHandlerClassname();
    }
    return "redirect:formResources.form?formId=" + resource.getForm().getId();
  }
}
