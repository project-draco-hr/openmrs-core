{
  PrintWriter writer=null;
  File destinatinDir=HL7Util.getHl7ArchivesDirectory();
  try {
    Calendar calendar=Calendar.getInstance(Context.getLocale());
    calendar.setTime(hl7InArchive.getDateCreated());
    File yearDir=new File(destinatinDir,Integer.toString(calendar.get(Calendar.YEAR)));
    if (!yearDir.isDirectory())     yearDir.mkdirs();
    File monthDir=null;
    if (calendar.get(Calendar.MONTH) < 9)     monthDir=new File(yearDir,"0" + Integer.toString(calendar.get(Calendar.MONTH) + 1));
 else     monthDir=new File(yearDir,Integer.toString(calendar.get(Calendar.MONTH) + 1));
    if (!monthDir.isDirectory())     monthDir.mkdirs();
    File dayDir=null;
    if (calendar.get(Calendar.DAY_OF_MONTH) < 10)     dayDir=new File(monthDir,"0" + Integer.toString(calendar.get(Calendar.DAY_OF_MONTH)));
 else     dayDir=new File(monthDir,Integer.toString(calendar.get(Calendar.DAY_OF_MONTH)));
    if (!dayDir.isDirectory())     dayDir.mkdirs();
    if (StringUtils.isBlank(hl7InArchive.getUuid()) || hl7InArchive.getHL7Source() == null || hl7InArchive.getHL7Source().getHL7SourceId() == null)     throw new DAOException("Can't write archive with a null or empty uuid to the file system or no source key");
    File fileToWriteTo=new File(dayDir,hl7InArchive.getUuid() + "_" + hl7InArchive.getHL7Source().getHL7SourceId()+ "_"+ calendar.getTimeInMillis()+ (StringUtils.isBlank(hl7InArchive.getHL7SourceKey()) ? "" : "_" + hl7InArchive.getHL7SourceKey())+ ".txt");
    writer=new PrintWriter(fileToWriteTo);
    writer.write(hl7InArchive.getHL7Data());
    if (writer.checkError()) {
      log.warn("An Error occured while writing hl7 archive with id '" + hl7InArchive.getHL7InArchiveId() + "' to the file system");
      return false;
    }
  }
 catch (  FileNotFoundException e) {
    log.warn("Failed to write hl7 archive with id '" + hl7InArchive.getHL7InArchiveId() + "' to the file system ",e);
    return false;
  }
 finally {
    if (writer != null)     writer.close();
  }
  return true;
}
