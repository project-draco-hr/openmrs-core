{
  String sql="select patient_id " + "from patient_program " + "where voided = false "+ "  and program_id = :programId ";
  if (toDate != null) {
    sql+="and (date_enrolled is null or date_enrolled <= :toDate) ";
  }
  if (fromDate != null) {
    sql+="and (date_completed is null or date_completed >= :fromDate) ";
  }
  Query q=sessionFactory.getCurrentSession().createSQLQuery(sql);
  q.setInteger("programId",program.getProgramId());
  if (toDate != null)   q.setDate("toDate",toDate);
  if (fromDate != null)   q.setDate("fromDate",fromDate);
  Set<Integer> ret=new HashSet<Integer>();
  for (  Integer ptId : (List<Integer>)q.list()) {
    ret.add(ptId);
  }
  return ret;
}
