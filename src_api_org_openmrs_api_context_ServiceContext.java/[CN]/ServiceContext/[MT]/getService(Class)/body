{
  log.debug("Getting service: " + cls);
synchronized (refreshingContext) {
    if (refreshingContext.booleanValue())     try {
      refreshingContext.wait();
    }
 catch (    InterruptedException e) {
      log.warn("Refresh lock was interrupted",e);
    }
  }
  ProxyFactory factory=proxyFactories.get(cls);
  if (factory == null)   throw new APIException("Service not found: " + cls);
  return factory.getProxy(OpenmrsClassLoader.getInstance());
}
