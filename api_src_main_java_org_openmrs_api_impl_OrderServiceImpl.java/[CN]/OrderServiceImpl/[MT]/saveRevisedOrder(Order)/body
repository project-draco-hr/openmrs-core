{
  if (!Order.Action.REVISE.equals(revisedOrder.getAction())) {
    throw new APIException("Action has to be 'REVISE'");
  }
  Order previousOrder=revisedOrder.getPreviousOrder();
  if (previousOrder == null) {
    throw new APIException("Previous order cannot be null");
  }
  if (Order.Action.DISCONTINUE.equals(previousOrder.getAction())) {
    throw new APIException("Cannot revise a discontinued order");
  }
  if (OrderUtil.isOrderActive(previousOrder,null)) {
    markAsDiscontinued(previousOrder,new Date());
  }
 else {
    throw new APIException("Cannot revise an inactive order.");
  }
  return saveOrderInternal(revisedOrder);
}
