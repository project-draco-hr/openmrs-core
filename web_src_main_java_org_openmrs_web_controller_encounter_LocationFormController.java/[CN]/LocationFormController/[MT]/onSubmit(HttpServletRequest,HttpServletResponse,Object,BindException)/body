{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    try {
      Location location=(Location)obj;
      WebAttributeUtil.handleSubmittedAttributesForType(location,errors,LocationAttribute.class,request,Context.getLocationService().getAllLocationAttributeTypes());
      if (errors.hasErrors()) {
        return showForm(request,response,errors);
      }
      LocationService locationService=Context.getLocationService();
      if (request.getParameter("saveLocation") != null) {
        locationService.saveLocation(location);
        httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,"Location.saved");
      }
 else       if (request.getParameter("retireLocation") != null) {
        locationService.retireLocation(location,location.getRetireReason());
        httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,"Location.retired");
      }
 else       if (request.getParameter("unretireLocation") != null) {
        locationService.unretireLocation(location);
        httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,"Location.unretired");
      }
    }
 catch (    APIException e) {
      log.error("Error while saving location: " + obj,e);
      httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,e.getMessage());
      return showForm(request,response,errors);
    }
    view=getSuccessView();
  }
  return new ModelAndView(new RedirectView(view));
}
