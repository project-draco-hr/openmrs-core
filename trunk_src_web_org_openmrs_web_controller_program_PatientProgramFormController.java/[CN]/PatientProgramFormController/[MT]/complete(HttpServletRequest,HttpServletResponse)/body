{
  String returnPage=request.getParameter("returnPage");
  if (returnPage == null) {
    throw new IllegalArgumentException("must specify a returnPage parameter in a call to enroll()");
  }
  String patientProgramIdStr=request.getParameter("patientProgramId");
  String dateCompletedStr=request.getParameter("dateCompleted");
  CustomDateEditor cde=new CustomDateEditor(new SimpleDateFormat(OpenmrsConstants.OPENMRS_LOCALE_DATE_PATTERNS().get(Context.getLocale().toString().toLowerCase()),Context.getLocale()),true,10);
  cde.setAsText(dateCompletedStr);
  Date dateCompleted=(Date)cde.getValue();
  PatientProgram p=Context.getProgramWorkflowService().getPatientProgram(Integer.valueOf(patientProgramIdStr));
  p.setDateCompleted(dateCompleted);
  Context.getProgramWorkflowService().updatePatientProgram(p);
  return new ModelAndView(new RedirectView(returnPage));
}
