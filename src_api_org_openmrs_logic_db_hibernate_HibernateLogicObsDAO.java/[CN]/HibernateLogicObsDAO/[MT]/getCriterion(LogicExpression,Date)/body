{
  Operator operator=logicExpression.getOperator();
  Object rightOperand=logicExpression.getRightOperand();
  Object leftOperand=null;
  if (logicExpression instanceof LogicExpressionBinary) {
    leftOperand=((LogicExpressionBinary)logicExpression).getLeftOperand();
  }
  List<Criterion> criterion=new ArrayList<Criterion>();
  String rootToken=logicExpression.getRootToken();
  Concept concept=Context.getConceptService().getConcept(rootToken);
  if (concept != null) {
    criterion.add(Restrictions.eq("concept",concept));
  }
 else {
    if (rootToken != null && (rootToken.equalsIgnoreCase(COMPONENT_ENCOUNTER_ID) || rootToken.equalsIgnoreCase(COMPONENT_OBS_DATETIME))) {
    }
 else {
      throw new LogicException("Concept: " + rootToken + " does not exist");
    }
  }
  if (operator == Operator.BEFORE) {
    criterion.add(Restrictions.lt("obsDatetime",rightOperand));
  }
 else   if (operator == Operator.AFTER) {
    criterion.add(Restrictions.gt("obsDatetime",rightOperand));
  }
 else   if (operator == Operator.AND || operator == Operator.OR) {
    Criterion leftCriteria=null;
    Criterion rightCriteria=null;
    if (leftOperand instanceof LogicExpression) {
      leftCriteria=this.getCriterion((LogicExpression)leftOperand,indexDate);
    }
    if (rightOperand instanceof LogicExpression) {
      rightCriteria=this.getCriterion((LogicExpression)rightOperand,indexDate);
    }
    if (leftCriteria != null && rightCriteria != null) {
      if (operator == Operator.AND) {
        criterion.add(Restrictions.and(leftCriteria,rightCriteria));
      }
      if (operator == Operator.OR) {
        criterion.add(Restrictions.or(leftCriteria,rightCriteria));
      }
    }
  }
 else   if (operator == Operator.NOT) {
    Criterion rightCriteria=null;
    if (rightOperand instanceof LogicExpression) {
      rightCriteria=this.getCriterion((LogicExpression)rightOperand,indexDate);
    }
    if (rightCriteria != null) {
      criterion.add(Restrictions.not(rightCriteria));
    }
  }
 else   if (operator == Operator.CONTAINS) {
    if (rightOperand instanceof Float) {
      concept=Context.getConceptService().getConcept(((Float)rightOperand).intValue());
      criterion.add(Restrictions.eq("valueCoded",concept));
    }
    if (rightOperand instanceof Double) {
      concept=Context.getConceptService().getConcept(((Double)rightOperand).intValue());
      criterion.add(Restrictions.eq("valueCoded",concept));
    }
 else     if (rightOperand instanceof Integer) {
      concept=Context.getConceptService().getConcept((Integer)rightOperand);
      criterion.add(Restrictions.eq("valueCoded",concept));
    }
 else     if (rightOperand instanceof String) {
      concept=Context.getConceptService().getConcept((String)rightOperand);
      criterion.add(Restrictions.eq("valueCoded",concept));
    }
 else     if (rightOperand instanceof Concept) {
      criterion.add(Restrictions.eq("valueCoded",rightOperand));
    }
 else     log.error("Invalid operand value for CONTAINS operation");
  }
 else   if (operator == Operator.EQUALS) {
    if (rootToken.equalsIgnoreCase(COMPONENT_ENCOUNTER_ID)) {
      EncounterService encounterService=Context.getEncounterService();
      Encounter encounter=encounterService.getEncounter((Integer)rightOperand);
      criterion.add(Restrictions.eq("encounter",encounter));
    }
 else     if (rightOperand instanceof Float || rightOperand instanceof Integer || rightOperand instanceof Double)     criterion.add(Restrictions.eq("valueNumeric",Double.parseDouble(rightOperand.toString())));
 else     if (rightOperand instanceof String)     criterion.add(Restrictions.eq("valueText",rightOperand));
 else     if (rightOperand instanceof Date)     if (leftOperand instanceof String && leftOperand.equals(COMPONENT_OBS_DATETIME)) {
      criterion.add(Restrictions.eq(COMPONENT_OBS_DATETIME,rightOperand));
    }
 else {
      criterion.add(Restrictions.eq("valueDatetime",rightOperand));
    }
 else     if (rightOperand instanceof Concept)     criterion.add(Restrictions.eq("valueCoded",rightOperand));
 else     log.error("Invalid operand value for EQUALS operation");
  }
 else   if (operator == Operator.LTE) {
    if (rightOperand instanceof Float || rightOperand instanceof Integer || rightOperand instanceof Double)     criterion.add(Restrictions.le("valueNumeric",Double.parseDouble(rightOperand.toString())));
 else     if (rightOperand instanceof Date)     if (leftOperand instanceof String && leftOperand.equals(COMPONENT_OBS_DATETIME)) {
      criterion.add(Restrictions.le(COMPONENT_OBS_DATETIME,rightOperand));
    }
 else {
      criterion.add(Restrictions.le("valueDatetime",rightOperand));
    }
 else     log.error("Invalid operand value for LESS THAN EQUAL operation");
  }
 else   if (operator == Operator.GTE) {
    if (rightOperand instanceof Float || rightOperand instanceof Integer || rightOperand instanceof Double)     criterion.add(Restrictions.ge("valueNumeric",Double.parseDouble(rightOperand.toString())));
 else     if (rightOperand instanceof Date)     if (leftOperand instanceof String && leftOperand.equals(COMPONENT_OBS_DATETIME)) {
      criterion.add(Restrictions.ge(COMPONENT_OBS_DATETIME,rightOperand));
    }
 else {
      criterion.add(Restrictions.ge("valueDatetime",rightOperand));
    }
 else     log.error("Invalid operand value for GREATER THAN EQUAL operation");
  }
 else   if (operator == Operator.LT) {
    if (rightOperand instanceof Float || rightOperand instanceof Integer || rightOperand instanceof Double)     criterion.add(Restrictions.lt("valueNumeric",Double.parseDouble(rightOperand.toString())));
 else     if (rightOperand instanceof Date)     if (leftOperand instanceof String && leftOperand.equals(COMPONENT_OBS_DATETIME)) {
      criterion.add(Restrictions.lt(COMPONENT_OBS_DATETIME,rightOperand));
    }
 else {
      criterion.add(Restrictions.lt("valueDatetime",rightOperand));
    }
 else     log.error("Invalid operand value for LESS THAN operation");
  }
 else   if (operator == Operator.GT) {
    if (rightOperand instanceof Float || rightOperand instanceof Integer || rightOperand instanceof Double)     criterion.add(Restrictions.gt("valueNumeric",Double.parseDouble(rightOperand.toString())));
 else     if (rightOperand instanceof Date)     if (leftOperand instanceof String && leftOperand.equals(COMPONENT_OBS_DATETIME)) {
      criterion.add(Restrictions.gt(COMPONENT_OBS_DATETIME,rightOperand));
    }
 else {
      criterion.add(Restrictions.gt("valueDatetime",rightOperand));
    }
 else     log.error("Invalid operand value for GREATER THAN operation");
  }
 else   if (operator == Operator.EXISTS) {
  }
 else   if (operator == Operator.ASOF && rightOperand instanceof Date) {
    indexDate=(Date)rightOperand;
    criterion.add(Restrictions.le("obsDatetime",indexDate));
  }
 else   if (operator == Operator.WITHIN && rightOperand instanceof Duration) {
    Duration duration=(Duration)rightOperand;
    Calendar within=Calendar.getInstance();
    within.setTime(indexDate);
    if (duration.getUnits() == Duration.Units.YEARS) {
      within.add(Calendar.YEAR,duration.getDuration().intValue());
    }
 else     if (duration.getUnits() == Duration.Units.MONTHS) {
      within.add(Calendar.MONTH,duration.getDuration().intValue());
    }
 else     if (duration.getUnits() == Duration.Units.WEEKS) {
      within.add(Calendar.WEEK_OF_YEAR,duration.getDuration().intValue());
    }
 else     if (duration.getUnits() == Duration.Units.DAYS) {
      within.add(Calendar.DAY_OF_YEAR,duration.getDuration().intValue());
    }
 else     if (duration.getUnits() == Duration.Units.MINUTES) {
      within.add(Calendar.MINUTE,duration.getDuration().intValue());
    }
 else     if (duration.getUnits() == Duration.Units.SECONDS) {
      within.add(Calendar.SECOND,duration.getDuration().intValue());
    }
    if (indexDate.compareTo(within.getTime()) > 0) {
      criterion.add(Restrictions.between("obsDatetime",within.getTime(),indexDate));
    }
 else {
      criterion.add(Restrictions.between("obsDatetime",indexDate,within.getTime()));
    }
  }
  Criterion c=null;
  for (  Criterion crit : criterion) {
    if (c == null) {
      c=crit;
    }
 else {
      c=Restrictions.and(c,crit);
    }
  }
  return c;
}
