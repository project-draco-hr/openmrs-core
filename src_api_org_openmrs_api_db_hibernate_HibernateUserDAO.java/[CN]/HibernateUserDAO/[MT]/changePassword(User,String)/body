{
  Session session=HibernateUtil.currentSession();
  User authUser=context.getAuthenticatedUser();
  if (authUser == null)   authUser=u;
  try {
    log.debug("udpating password");
    HibernateUtil.beginTransaction();
    String salt=Security.getRandomToken();
    String newPassword=Security.encodeString(pw + salt);
    session.createQuery("update User set password = :pw, salt = :salt, changed_by = :changed, date_changed = :date where user_id = :userid").setParameter("pw",newPassword).setParameter("salt",salt).setParameter("userid",u.getUserId()).setParameter("changed",authUser.getUserId()).setParameter("date",new Date()).executeUpdate();
    HibernateUtil.commitTransaction();
  }
 catch (  APIException e) {
    log.error(e);
    throw new DAOException(e);
  }
}
