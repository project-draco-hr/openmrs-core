{
  if (user.getUserId() == null)   createUser(user,"");
 else {
    if (log.isDebugEnabled()) {
      log.debug("update user id: " + user.getUserId());
    }
    Object obj=sessionFactory.getCurrentSession().get(Person.class,user.getUserId());
    if (!(obj instanceof User)) {
      insertUserStub(user);
    }
    sessionFactory.getCurrentSession().merge(user);
  }
}
