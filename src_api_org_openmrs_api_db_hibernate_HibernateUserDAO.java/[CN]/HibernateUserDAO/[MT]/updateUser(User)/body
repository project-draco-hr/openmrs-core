{
  if (user.getCreator() == null)   createUser(user,"");
 else {
    if (log.isDebugEnabled()) {
      log.debug("update user id: " + user.getUserId());
    }
    Session session=HibernateUtil.currentSession();
    try {
      HibernateUtil.beginTransaction();
      user=updateProperties(user);
      try {
        session.update(user);
      }
 catch (      NonUniqueObjectException e) {
        session.merge(user);
      }
      HibernateUtil.commitTransaction();
    }
 catch (    Exception e) {
      HibernateUtil.rollbackTransaction();
      throw new DAOException(e);
    }
  }
}
