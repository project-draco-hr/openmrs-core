{
  try {
    String fileName=obs.getComplexData().getTitle();
    File outfile=getOutputFileToWrite(obs);
    OutputStream out=new FileOutputStream(outfile,false);
    FileInputStream mediaStream=(FileInputStream)obs.getComplexData().getData();
    OpenmrsUtil.copyFile(mediaStream,out);
    obs.setComplexData(null);
    obs.setValueComplex(fileName + "|" + outfile.getName());
    out.close();
  }
 catch (  IOException ioe) {
    throw new APIException("Trying to write complex obs to the file system. ",ioe);
  }
  return obs;
}
