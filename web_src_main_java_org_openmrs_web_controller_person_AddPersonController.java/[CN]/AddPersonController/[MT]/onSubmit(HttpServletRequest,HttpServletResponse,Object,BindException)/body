{
  Map<String,String> person=getParametersFromRequest(request);
  String personId=person.get(PERSON_ID);
  String viewType=person.get(VIEW_TYPE);
  String personType=person.get(PERSON_TYPE);
  if (StringUtils.isEmpty(personId)) {
    if ("view".equals(viewType) || "shortEdit".equals(viewType)) {
      viewType="shortEdit";
    }
 else {
      viewType="edit";
    }
    return new ModelAndView(new RedirectView(getPersonURL("",personType,viewType,request)));
  }
 else {
    if ("view".equals(viewType) && "patient".equals(personType)) {
      try {
        if (Context.getPatientService().getPatient(Integer.valueOf(personId)) == null) {
          viewType="shortEdit";
        }
      }
 catch (      Exception noPatientEx) {
        viewType="shortEdit";
      }
    }
    return new ModelAndView(new RedirectView(getPersonURL(personId,personType,viewType,request)));
  }
}
