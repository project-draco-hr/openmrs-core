{
  startup();
  try {
    Velocity.init();
  }
 catch (  Exception e) {
    log.error("Error initializing Velocity engine",e);
  }
  Context.authenticate("admin","test");
  ReportService rs=Context.getReportService();
  DataExportReportObject dataExport=(DataExportReportObject)rs.getReportObject(4);
  VelocityContext velocityContext=new VelocityContext();
  Writer report=new StringWriter();
  Locale locale=Context.getLocale();
  velocityContext.put("locale",locale);
  DataExportFunctions functions=new DataExportFunctions();
  velocityContext.put("fn",functions);
  report.append("Report: " + dataExport.getName() + "\n\n");
  PatientSet patientSet=dataExport.generatePatientSet();
  velocityContext.put("patientSet",patientSet);
  String template=dataExport.generateTemplate();
  try {
    Velocity.evaluate(velocityContext,report,this.getClass().getName(),template);
  }
 catch (  Exception e) {
    log.error("Error evaluating data export " + dataExport.getReportObjectId(),e);
    report.append("\n\nError: \n" + e.toString());
    throw e;
  }
  report.append("\ntemplate: " + template);
  log.error("report: " + report);
  shutdown();
}
