{
  initializeInMemoryDatabase();
  executeDataSet("org/openmrs/include/DataExportTest-patients.xml");
  executeDataSet("org/openmrs/include/DataExportTest-obs.xml");
  authenticate();
  DataExportReportObject export=new DataExportReportObject();
  export.setName("NO CONCEPT, THEN GET WEIGHTS");
  export.addSimpleColumn("PATIENT_ID","$!{fn.patientId}");
  ConceptColumn firstNObs=new ConceptColumn();
  firstNObs.setColumnName("Other");
  firstNObs.setColumnType("concept");
  firstNObs.setConceptId(5090);
  firstNObs.setConceptName("OTHER CONCEPT");
  firstNObs.setExtras(new String[]{"obsDatetime"});
  firstNObs.setModifier(DataExportReportObject.MODIFIER_FIRST_NUM);
  firstNObs.setModifierNum(2);
  export.getColumns().add(firstNObs);
  ConceptColumn lastNObs=new ConceptColumn();
  lastNObs.setColumnName("W-last");
  lastNObs.setColumnType("concept");
  lastNObs.setConceptId(5089);
  lastNObs.setConceptName("Weight (KG)");
  lastNObs.setExtras(new String[]{"obsDatetime"});
  lastNObs.setModifier(DataExportReportObject.MODIFIER_LAST_NUM);
  lastNObs.setModifierNum(2);
  export.getColumns().add(lastNObs);
  PatientSet patients=new PatientSet();
  patients.add(2);
  DataExportUtil.generateExport(export,patients,"\t");
  File exportFile=DataExportUtil.getGeneratedFile(export);
  String expectedOutput="PATIENT_ID	Other	Other_obsDatetime 	Other_(1)	Other_obsDatetime_(1)	W-last	W-last_obsDatetime 	W-last_(1)	W-last_obsDatetime_(1)\n2					10.0	02/18/2006	9.0	02/17/2006\n";
  String output=OpenmrsUtil.getFileAsString(exportFile);
  exportFile.delete();
  assertEquals("The output is not right.",expectedOutput,output);
}
