{
  MockHttpServletRequest request=new MockHttpServletRequest("GET","");
  HttpServletResponse response=new MockHttpServletResponse();
  request.setAttribute(WebConstants.INIT_REQ_UNIQUE_ID,"1");
  request.getSession().setAttribute(WebConstants.OPENMRS_PORTLET_LAST_REQ_ID,"0");
  request.setAttribute("javax.servlet.include.servlet_path","testPortlet");
  request.setAttribute("org.openmrs.portlet.parameters",new HashMap());
  request.setAttribute("org.openmrs.portlet.patientId",patientId);
  ModelAndView modelAndView=new PortletController().handleRequest(request,response);
  return (Map<String,Object>)modelAndView.getModel().get("model");
}
