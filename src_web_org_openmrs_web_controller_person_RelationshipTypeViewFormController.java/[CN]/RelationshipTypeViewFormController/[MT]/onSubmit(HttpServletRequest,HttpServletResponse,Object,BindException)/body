{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String[] relationshipTypeIds=request.getParameterValues("relationshipTypeIds");
    String[] displayOrders=request.getParameterValues("displayOrders");
    List<String> preferredTypes=new ArrayList<String>();
    String[] preferredTypesArray=request.getParameterValues("preferredTypes");
    if (preferredTypesArray != null)     Collections.addAll(preferredTypes,preferredTypesArray);
    PersonService ps=Context.getPersonService();
    for (int i=0; i < relationshipTypeIds.length; i++) {
      String id=relationshipTypeIds[i];
      String displayOrder=displayOrders[i];
      Boolean preferred=preferredTypes.contains(id);
      RelationshipType type=ps.getRelationshipType(Integer.valueOf(id));
      type.setWeight(Integer.valueOf(displayOrder));
      type.setPreferred(preferred);
      ps.saveRelationshipType(type);
    }
    String success=getMessageSourceAccessor().getMessage("RelationshipType.views.saved");
    view=getSuccessView();
    httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success);
  }
  return new ModelAndView(new RedirectView(view));
}
