{
  ReportSchema pepfarReportSchema=new ReportSchema();
  List<DataSetDefinition> dataSets=new ArrayList<DataSetDefinition>();
  CohortDataSetDefinition cohortDataSetDef=new CohortDataSetDefinition();
  cohortDataSetDef.setName("Sheet1");
  cohortDataSetDef.addStrategy("1.a",new StaticCohortDefinition(new Cohort()));
  pepfarReportSchema.setDataSetDefinitions(dataSets);
  Parameter startDateParam=new Parameter("report.startDate","When does the report period start?",Date.class,null);
  Parameter endDateParam=new Parameter("report.endDate","When does the report period end?",Date.class,null);
  Parameter locationParam=new Parameter("report.location","For which clinic is this report?",Location.class,null);
  List<Parameter> parameters=new ArrayList<Parameter>();
  parameters.add(startDateParam);
  parameters.add(endDateParam);
  parameters.add(locationParam);
  pepfarReportSchema.setReportParameters(parameters);
  Cohort inputStaticCohort=new Cohort(1);
  inputStaticCohort.addMember(1001);
  inputStaticCohort.addMember(1002);
  inputStaticCohort.addMember(1003);
  pepfarReportSchema.setFilter(new StaticCohortDefinition(inputStaticCohort));
  pepfarReportSchema.setReportSchemaId(123);
  pepfarReportSchema.setName("PEPFAR report");
  pepfarReportSchema.setDescription("The PEPFAR description is(n't) here.");
  Serializer serializer=OpenmrsUtil.getSerializer();
  StringWriter writer=new StringWriter();
  serializer.write(pepfarReportSchema,writer);
  String correctOutput="<reportSchema id=\"1\" reportSchemaId=\"123\">\n" + "   <filter class=\"org.openmrs.cohort.StaticCohortDefinition\" id=\"2\">\n" + "      <cohort id=\"3\" voided=\"false\" cohortId=\"1\">\n"+ "         <memberIds class=\"java.util.HashSet\" id=\"4\">\n"+ "            <integer id=\"5\">1002</integer>\n"+ "            <integer id=\"6\">1003</integer>\n"+ "            <integer id=\"7\">1001</integer>\n"+ "         </memberIds>\n"+ "      </cohort>\n"+ "   </filter>\n"+ "   <parameters class=\"java.util.ArrayList\" id=\"8\">\n"+ "      <parameter id=\"9\" clazz=\"java.util.Date\">\n"+ "         <label id=\"10\"><![CDATA[When does the report period start?]]></label>\n"+ "         <name id=\"11\"><![CDATA[report.startDate]]></name>\n"+ "      </parameter>\n"+ "      <parameter id=\"12\" clazz=\"java.util.Date\">\n"+ "         <label id=\"13\"><![CDATA[When does the report period end?]]></label>\n"+ "         <name id=\"14\"><![CDATA[report.endDate]]></name>\n"+ "      </parameter>\n"+ "      <parameter id=\"15\" clazz=\"org.openmrs.Location\">\n"+ "         <label id=\"16\"><![CDATA[For which clinic is this report?]]></label>\n"+ "         <name id=\"17\"><![CDATA[report.location]]></name>\n"+ "      </parameter>\n"+ "   </parameters>\n"+ "   <description id=\"18\"><![CDATA[The PEPFAR description is(n't) here.]]></description>\n"+ "   <dataSets class=\"java.util.ArrayList\" id=\"19\"/>\n"+ "   <name id=\"20\"><![CDATA[PEPFAR report]]></name>\n"+ "</reportSchema>";
  String xmlOutput=writer.toString();
  XMLAssert.assertXpathEvaluatesTo("org.openmrs.cohort.StaticCohortDefinition","//reportSchema/filter/@class",xmlOutput);
  XMLAssert.assertXpathEvaluatesTo("1001","//reportSchema/filter/cohort/memberIds/integer",xmlOutput);
  ReportSchema deserializedSchema=serializer.read(ReportSchema.class,correctOutput);
  assertTrue("The # of params shouldn't be: " + deserializedSchema.getReportParameters().size(),deserializedSchema.getReportParameters().size() == 3);
  assertTrue("The name shouldn't be: " + deserializedSchema.getName(),deserializedSchema.getName().equals("PEPFAR report"));
  Cohort idsFromStaticCohort=((StaticCohortDefinition)deserializedSchema.getFilter()).getCohort();
  int size=idsFromStaticCohort.getMemberIds().size();
  assertTrue("There should be 3 patients in the static cohort, not: " + size,size == 3);
}
