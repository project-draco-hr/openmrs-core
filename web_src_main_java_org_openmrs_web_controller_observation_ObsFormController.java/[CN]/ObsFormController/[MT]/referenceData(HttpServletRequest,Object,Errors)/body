{
  Obs obs=(Obs)obj;
  Map<String,Object> map=new HashMap<String,Object>();
  String defaultVerbose="false";
  if (Context.isAuthenticated()) {
    map.put("forms",Context.getFormService().getAllForms());
    if (obs.getConcept() != null) {
      Concept concept=Context.getConceptService().getConcept(obs.getConcept().getConceptId());
      map.put("conceptName",concept.getName(request.getLocale()));
      ObsService os=Context.getObsService();
      Integer obsId=obs.getObsId();
      if (obsId != null && obs.getConcept().isComplex()) {
        ComplexObsHandler handler=os.getHandler(obs);
        if (handler.supportsView(ComplexObsHandler.HTML_VIEW)) {
          Obs complexObs_html=handler.getObs(obs,ComplexObsHandler.HTML_VIEW);
          Assert.notNull(complexObs_html,"Handler declares HTML view support but fails to deliver");
          ComplexData complexData=complexObs_html.getComplexData();
          map.put("htmlView",complexData.getData());
        }
        if (handler.supportsView(ComplexObsHandler.URI_VIEW)) {
          Obs complexObs_uri=handler.getObs(obs,ComplexObsHandler.URI_VIEW);
          Assert.notNull(complexObs_uri,"Handler declares URL view support but fails to deliver");
          ComplexData complexData=complexObs_uri.getComplexData();
          map.put("hyperlinkView",complexData.getData());
        }
      }
    }
    defaultVerbose=Context.getAuthenticatedUser().getUserProperty(OpenmrsConstants.USER_PROPERTY_SHOW_VERBOSE);
  }
  map.put("defaultVerbose",defaultVerbose.equals("true") ? true : false);
  String editReason=request.getParameter("editReason");
  if (editReason == null) {
    editReason="";
  }
  map.put("editReason",editReason);
  return map;
}
