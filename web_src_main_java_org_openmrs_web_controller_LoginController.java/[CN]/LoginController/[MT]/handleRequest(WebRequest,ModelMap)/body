{
  if (Context.getAuthenticatedUser() != null) {
    model.addAttribute("foundMissingPrivileges",webRequest.getAttribute(WebConstants.FOUND_MISSING_PRIVILEGES,WebRequest.SCOPE_SESSION));
    webRequest.removeAttribute(WebConstants.FOUND_MISSING_PRIVILEGES,WebRequest.SCOPE_SESSION);
    String deniedPage=null;
    String requiredPrivileges=null;
    String exceptionMsg=null;
    if (webRequest.getAttribute(WebConstants.DENIED_PAGE,WebRequest.SCOPE_SESSION) != null) {
      String deniedPageTemp=webRequest.getAttribute(WebConstants.DENIED_PAGE,WebRequest.SCOPE_SESSION).toString();
      webRequest.removeAttribute(WebConstants.DENIED_PAGE,WebRequest.SCOPE_SESSION);
      if (StringUtils.isNotBlank(deniedPageTemp))       deniedPage=deniedPageTemp;
    }
    if (webRequest.getAttribute(WebConstants.REQUIRED_PRIVILEGES,WebRequest.SCOPE_SESSION) != null) {
      String requiredPrivilegesTemp=webRequest.getAttribute(WebConstants.REQUIRED_PRIVILEGES,WebRequest.SCOPE_SESSION).toString();
      webRequest.removeAttribute(WebConstants.REQUIRED_PRIVILEGES,WebRequest.SCOPE_SESSION);
      if (StringUtils.isNotBlank(requiredPrivilegesTemp))       requiredPrivileges=requiredPrivilegesTemp;
    }
    if (webRequest.getAttribute(WebConstants.UNCAUGHT_EXCEPTION_MESSAGE,WebRequest.SCOPE_SESSION) != null) {
      String exceptionMsgTemp=webRequest.getAttribute(WebConstants.UNCAUGHT_EXCEPTION_MESSAGE,WebRequest.SCOPE_SESSION).toString();
      webRequest.removeAttribute(WebConstants.UNCAUGHT_EXCEPTION_MESSAGE,WebRequest.SCOPE_SESSION);
      if (StringUtils.isNotBlank(exceptionMsgTemp))       exceptionMsg=exceptionMsgTemp;
    }
    String alertMessage=null;
    String buttonLabelMsgCode="general.requestAccessToPage";
    if (requiredPrivileges != null && deniedPage != null) {
      alertMessage=Context.getMessageSourceService().getMessage("general.alert.requestPrivilegesForPage",new String[]{Context.getAuthenticatedUser().getUsername(),requiredPrivileges,deniedPage},null);
      buttonLabelMsgCode="general.requestPrivileges";
    }
 else     if (exceptionMsg != null && deniedPage != null) {
      alertMessage=Context.getMessageSourceService().getMessage("general.alert.privilegesForPageOnException",new String[]{exceptionMsg,Context.getAuthenticatedUser().getUsername(),deniedPage},null);
    }
 else     if (deniedPage != null) {
      alertMessage=Context.getMessageSourceService().getMessage("general.alert.requestUnKnownPrivilegesForPage",new String[]{Context.getAuthenticatedUser().getUsername(),deniedPage},null);
    }
 else     if (requiredPrivileges != null) {
      alertMessage=Context.getMessageSourceService().getMessage("general.alert.requestPrivileges",new String[]{Context.getAuthenticatedUser().getUsername(),requiredPrivileges},null);
      buttonLabelMsgCode="general.requestPrivileges";
    }
 else     if (exceptionMsg != null) {
      alertMessage=Context.getMessageSourceService().getMessage("general.alert.requestPrivileges",new String[]{Context.getAuthenticatedUser().getUsername(),exceptionMsg},null);
    }
    model.put("alertMessage",JavaScriptUtils.javaScriptEscape(alertMessage));
    model.put("buttonLabel",HtmlUtils.htmlEscape(Context.getMessageSourceService().getMessage(buttonLabelMsgCode)));
  }
  return LOGIN_FORM;
}
