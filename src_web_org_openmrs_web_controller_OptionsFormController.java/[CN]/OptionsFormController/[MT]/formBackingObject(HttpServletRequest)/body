{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  OptionsForm opts=new OptionsForm();
  if (context != null && context.isAuthenticated()) {
    User user=context.getAuthenticatedUser();
    Map<String,String> props=user.getProperties();
    opts.setDefaultLocation(props.get(OpenmrsConstants.USER_PROPERTY_DEFAULT_LOCATION));
    opts.setDefaultLocale(props.get(OpenmrsConstants.USER_PROPERTY_DEFAULT_LOCALE));
    opts.setShowRetiredMessage(new Boolean(props.get(OpenmrsConstants.USER_PROPERTY_SHOW_RETIRED)));
    opts.setVerbose(new Boolean(props.get(OpenmrsConstants.USER_PROPERTY_SHOW_VERBOSE)));
    opts.setUsername(user.getUsername());
    opts.setSecretQuestionNew(user.getSecretQuestion());
    opts.setNotification(props.get(OpenmrsConstants.USER_PROPERTY_NOTIFICATION));
    opts.setNotificationAddress(props.get(OpenmrsConstants.USER_PROPERTY_NOTIFICATION_ADDRESS));
  }
  return opts;
}
