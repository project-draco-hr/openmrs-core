{
  PreparedStatement updateDrugOrderStatement=null;
  Boolean autoCommit=null;
  try {
    autoCommit=connection.getAutoCommit();
    connection.setAutoCommit(false);
    updateDrugOrderStatement=connection.prepareStatement("update drug_order set dose_units = ? where units = ?");
    for (    String unit : uniqueUnits) {
      Integer conceptIdForUnit=DatabaseUtil.getConceptIdForUnits(connection.getUnderlyingConnection(),unit);
      if (conceptIdForUnit == null) {
        throw new CustomChangeException("No concept mapping found for unit: " + unit);
      }
      updateDrugOrderStatement.setInt(1,conceptIdForUnit);
      updateDrugOrderStatement.setString(2,unit);
      updateDrugOrderStatement.executeUpdate();
      updateDrugOrderStatement.clearParameters();
    }
    connection.commit();
  }
 catch (  DatabaseException e) {
    handleError(connection,e);
  }
catch (  SQLException e) {
    handleError(connection,e);
  }
 finally {
    if (autoCommit != null) {
      connection.setAutoCommit(autoCommit);
    }
    if (updateDrugOrderStatement != null) {
      updateDrugOrderStatement.close();
    }
  }
}
