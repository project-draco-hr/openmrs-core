{
  Log log=LogFactory.getLog(Listener.class);
  log.debug("Starting the OpenMRS webapp");
  try {
    OpenmrsUtil.validateJavaVersion();
    ServletContext servletContext=event.getServletContext();
    loadConstants(servletContext);
    clearDWRFile(servletContext);
    Properties props=getRuntimeProperties();
    if (props != null) {
      runtimePropertiesFound=true;
      Context.setRuntimeProperties(props);
    }
    Thread.currentThread().setContextClassLoader(OpenmrsClassLoader.getInstance());
    if (!setupNeeded()) {
      copyCustomizationIntoWebapp(servletContext,props);
      ApplicationContext parent=loadParentContext(servletContext);
      WebApplicationContext context=createWebApplicationContext(servletContext,parent);
      servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE,context);
      WebDaemon.startOpenmrs(event.getServletContext());
    }
  }
 catch (  Throwable t) {
    errorAtStartup=t;
    log.fatal("Got exception while starting up: ",t);
  }
}
