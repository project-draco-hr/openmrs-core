{
  RowPerObsDataSetDefinition definition=(RowPerObsDataSetDefinition)dataSetDefinition;
  Cohort patients=inputCohort;
  if (definition.getFilter() != null) {
    if (patients != null)     patients=Cohort.intersect(patients,Context.getCohortService().evaluate(definition.getFilter(),evalContext));
 else     patients=Context.getCohortService().evaluate(definition.getFilter(),evalContext);
  }
  RowPerObsDataSet ret=new RowPerObsDataSet();
  ret.setDefinition(definition);
  ret.setEvaluationContext(evalContext);
  List<Concept> concepts=new ArrayList<Concept>(definition.getQuestions());
  List<Obs> list=Context.getObsService().getObservations(patients,concepts,definition.getFromDate(),definition.getToDate());
  ret.setData(list);
  return ret;
}
