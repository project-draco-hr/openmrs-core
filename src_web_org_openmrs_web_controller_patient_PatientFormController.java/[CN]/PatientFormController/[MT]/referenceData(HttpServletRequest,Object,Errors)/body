{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  Patient patient=(Patient)obj;
  List<Form> forms=new Vector<Form>();
  Map<String,Object> map=new HashMap<String,Object>();
  List<Encounter> encounters=new Vector<Encounter>();
  if (context != null && context.isAuthenticated()) {
    forms.addAll(context.getFormEntryService().getForms());
    Set<Encounter> encs=context.getEncounterService().getEncounters(patient);
    if (encs != null && encs.size() > 0)     encounters.addAll(encs);
  }
  map.put("forms",forms);
  map.put("emptyIdentifier",new PatientIdentifier());
  map.put("emptyName",new PatientName());
  map.put("emptyAddress",new PatientAddress());
  map.put("encounters",encounters);
  map.put("datePattern",dateFormat.toLocalizedPattern().toLowerCase());
  return map;
}
