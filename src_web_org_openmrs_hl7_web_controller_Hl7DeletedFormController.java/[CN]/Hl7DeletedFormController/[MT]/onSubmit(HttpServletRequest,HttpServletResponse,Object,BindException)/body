{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  StringBuffer success=new StringBuffer();
  StringBuffer error=new StringBuffer();
  MessageSourceAccessor msa=getMessageSourceAccessor();
  String[] queueForm=request.getParameterValues("queueId");
  HL7Service hL7Service=Context.getHL7Service();
  if (queueForm != null) {
    for (    String queueId : queueForm) {
      Object[] args=new Object[]{queueId};
      try {
        HL7InArchive hl7InArchive=hL7Service.getHL7InArchive(Integer.valueOf(queueId));
        HL7InQueue hl7InQueue=new HL7InQueue(hl7InArchive);
        hL7Service.saveHL7InQueue(hl7InQueue);
        hL7Service.purgeHL7InArchive(hl7InArchive);
        success.append(msa.getMessage("Hl7inQueue.queueForm.restored",args) + "<br/>");
      }
 catch (      APIException e) {
        log.warn("Error restoring deleted queue item",e);
        error.append(msa.getMessage("Hl7inQueue.queueForm.error",args) + "<br/>");
      }
    }
  }
  view=getSuccessView();
  if (!success.toString().equals("")) {
    httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success.toString());
  }
  if (!error.toString().equals("")) {
    httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error.toString());
  }
  return new ModelAndView(new RedirectView(view));
}
