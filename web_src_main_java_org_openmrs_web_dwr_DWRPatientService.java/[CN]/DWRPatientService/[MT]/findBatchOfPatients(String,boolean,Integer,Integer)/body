{
  if (maximumResults == null)   maximumResults=getMaximumSearchResults();
  if (length != null && length > maximumResults)   length=maximumResults;
  List<Object> patientList=new Vector<Object>();
  PatientService ps=Context.getPatientService();
  Collection<Patient> patients;
  try {
    patients=ps.getPatients(searchValue,start,length);
  }
 catch (  APIAuthenticationException e) {
    patientList.add(Context.getMessageSourceService().getMessage("Patient.search.error") + " - " + e.getMessage());
    return patientList;
  }
  patientList=new Vector<Object>(patients.size());
  for (  Patient p : patients)   patientList.add(new PatientListItem(p,searchValue));
  if ((length == null || length > 2) && patients.size() < 3 && !searchValue.matches(".*\\d+.*")) {
    String[] names=searchValue.split(" ");
    String newSearch="";
    for (    String name : names) {
      if (name.length() > 3)       name=name.substring(0,4);
      newSearch+=" " + name;
    }
    newSearch=newSearch.trim();
    if (!newSearch.equals(searchValue)) {
      Collection<Patient> newPatients=ps.getPatients(newSearch,start,length);
      patients=CollectionUtils.union(newPatients,patients);
      if (newPatients.size() > 0) {
        patientList=new Vector<Object>(patients.size());
        for (        Patient p : newPatients) {
          PatientListItem pi=new PatientListItem(p,newSearch);
          patientList.add(pi);
        }
      }
    }
  }
 else   if (patients.size() == 0 && searchValue.matches(".*\\d+.*")) {
    Collection<IdentifierValidator> pivs=ps.getAllIdentifierValidators();
    boolean shouldWarnUser=true;
    boolean validCheckDigit=false;
    boolean identifierMatchesValidationScheme=false;
    for (    IdentifierValidator piv : pivs) {
      try {
        if (piv.isValid(searchValue)) {
          shouldWarnUser=false;
          validCheckDigit=true;
        }
        identifierMatchesValidationScheme=true;
      }
 catch (      UnallowedIdentifierException e) {
      }
    }
    if (identifierMatchesValidationScheme) {
      if (shouldWarnUser)       patientList.add("<p style=\"color:red; font-size:big;\"><b>WARNING: Identifier has been typed incorrectly!  Please double check the identifier.</b></p>");
 else       if (validCheckDigit)       patientList.add("<p style=\"color:green; font-size:big;\"><b>This identifier has been entered correctly, but still no patients have been found.</b></p>");
    }
  }
  return patientList;
}
