{
  executeDataSet("org/openmrs/test/reporting/export/include/DataExportTest-patients.xml");
  executeDataSet("org/openmrs/test/reporting/export/include/DataExportTest-obs.xml");
  RowPerObsDataExportReportObject export=new RowPerObsDataExportReportObject();
  export.setName("Given names export");
  export.addSimpleColumn("PATIENT_ID","$!{fn.patientId}");
  export.addSimpleColumn("Name","$!{fn.getPatientAttr('PersonName', 'givenName')}");
  export.setRowPerObsColumn("Weight (KG)","5089",new String[]{"location"});
  Cohort patients=new Cohort();
  patients.addMember(2);
  patients.addMember(6);
  patients.addMember(7);
  patients.addMember(8);
  DataExportUtil.generateExport(export,patients,"\t",null);
  File exportFile=DataExportUtil.getGeneratedFile(export);
  String expectedOutput="PATIENT_ID	Name	Weight (KG)	Weight (KG)_location\n2	John	10.0	Test Location\n2	John	9.0	Test Location\n2	John	8.0	Test Location\n2	John	7.0	Test Location\n2	John	6.0	Test Location\n2	John	5.0	Test Location\n2	John	4.0	Test Location\n2	John	3.0	Test Location\n2	John	2.0	Test Location\n2	John	1.0	Test Location\n6	Johnny	\n7	Collet	61.0	Xanadu\n8	Anet	\n";
  String output=OpenmrsUtil.getFileAsString(exportFile);
  exportFile.delete();
  assertEquals("The output is not right.",expectedOutput,output);
}
