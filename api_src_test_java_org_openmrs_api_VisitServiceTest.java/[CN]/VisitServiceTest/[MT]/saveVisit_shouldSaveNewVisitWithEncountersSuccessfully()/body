{
  VisitService vs=Context.getVisitService();
  Integer originalSize=vs.getAllVisits().size();
  Visit visit=new Visit(new Patient(2),new VisitType(1),new Date());
  Encounter encounter=Context.getEncounterService().getEncounter(4);
  HashSet<Encounter> encounters=new HashSet<Encounter>();
  encounters.add(encounter);
  visit.setEncounters(encounters);
  vs.saveVisit(visit);
  int visitId=visit.getVisitId();
  Context.flushSession();
  Context.clearSession();
  visit=Context.getVisitService().getVisit(visitId);
  assertNotNull(visit.getId());
  assertNotNull(visit.getUuid());
  assertNotNull(visit.getCreator());
  assertNotNull(visit.getDateCreated());
  assertEquals(originalSize + 1,vs.getAllVisits().size());
  assertTrue("Encounter size is not 1",visit.getEncounters().size() == 1);
}
