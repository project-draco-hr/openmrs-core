{
  super.beforeCreateEncounter(encounter);
  if (encounter.getVisit() != null)   return;
  Visit visit=new Visit();
  visit.setStartDatetime(encounter.getEncounterDatetime());
  visit.setLocation(encounter.getLocation());
  visit.setPatient(encounter.getPatient());
  visit.setVisitType(getVisitType(encounter));
  visit.setStopDatetime(OpenmrsUtil.getLastMomentOfDay(encounter.getEncounterDatetime()));
  encounter.setVisit(visit);
}
