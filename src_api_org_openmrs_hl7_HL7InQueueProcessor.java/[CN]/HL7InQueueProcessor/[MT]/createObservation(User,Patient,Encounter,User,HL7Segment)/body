{
  try {
    String hl7Datatype=obx.getField(2);
    Integer conceptId=Integer.parseInt(obx.getComponent(3,1));
    Concept concept=context.getConceptService().getConcept(conceptId);
    String value=obx.getField(5);
    String[] valueComponents=obx.getComponents(5);
    String dateTimeRaw=obx.getField(14);
    Date dateTime;
    if (dateTimeRaw.length() < 1)     if (encounter != null)     dateTime=encounter.getEncounterDatetime();
 else     dateTime=new Date();
 else     dateTime=HL7Util.parseHL7Timestamp(obx.getField(14));
    Obs obs=new Obs();
    obs.setPatient(patient);
    obs.setConcept(concept);
    obs.setEncounter(encounter);
    obs.setObsDatetime(dateTime);
    obs.setLocation(encounter.getLocation());
    obs.setCreator(enterer);
    if (encounter != null)     obs.setDateCreated(encounter.getDateCreated());
    if (hl7Datatype.equals("NM"))     obs.setValueNumeric(Double.valueOf(value));
 else     if (hl7Datatype.equals("CWE") || hl7Datatype.equals("CE")) {
      if (valueComponents[0].equals(OpenmrsConstants.PROPOSED_CONCEPT_IDENTIFIER)) {
        proposeConcept(encounter,concept,valueComponents[1],enterer);
        return;
      }
 else {
        Integer valueConceptId=Integer.parseInt(valueComponents[0]);
        Concept valueConcept=context.getConceptService().getConcept(valueConceptId);
        obs.setValueCoded(valueConcept);
      }
    }
 else     if (hl7Datatype.equals("DT")) {
      Date valueDate=HL7Util.parseHL7Date(value);
      obs.setValueDatetime(valueDate);
    }
 else     if (hl7Datatype.equals("TS")) {
      Date valueTimestamp=HL7Util.parseHL7Timestamp(value);
      obs.setValueDatetime(valueTimestamp);
    }
 else     if (hl7Datatype.equals("TM")) {
      Date valueTime=HL7Util.parseHL7Time(value);
      obs.setValueDatetime(valueTime);
    }
 else     if (hl7Datatype.equals("ST"))     obs.setValueText(value);
 else {
    }
    context.getObsService().createObs(obs);
  }
 catch (  Exception e) {
    throw new HL7Exception(e);
  }
}
