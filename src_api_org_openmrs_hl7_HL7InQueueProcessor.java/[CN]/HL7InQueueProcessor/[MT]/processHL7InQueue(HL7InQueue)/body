{
  if (log.isDebugEnabled())   log.debug("Processing HL7 inbound queue (id=" + hl7InQueue.getHL7InQueueId() + ",key="+ hl7InQueue.getHL7SourceKey()+ ")");
  String hl7Message=hl7InQueue.getHL7Data();
  try {
    if (log.isDebugEnabled())     log.debug("Sending HL7 message to HL7 receiver");
    receiver.processMessage(hl7Message);
    if (log.isDebugEnabled())     log.debug("Archiving HL7 inbound queue entry");
    HL7InArchive hl7InArchive=new HL7InArchive(hl7InQueue);
    Context.getHL7Service().saveHL7InArchive(hl7InArchive);
    if (log.isDebugEnabled())     log.debug("Removing HL7 message from inbound queue");
    Context.getHL7Service().purgeHL7InQueue(hl7InQueue);
  }
 catch (  HL7Exception e) {
    boolean skipError=false;
    log.error("Unable to process hl7inqueue: " + hl7InQueue.getHL7InQueueId(),e);
    log.error("Hl7inqueue source: " + hl7InQueue.getHL7Source());
    log.error("hl7_processor.ignore_missing_patient_non_local? " + Context.getAdministrationService().getGlobalProperty("hl7_processor.ignore_missing_patient_non_local","false"));
    if (e.getCause() != null && e.getCause().getMessage().equals("Could not resolve patient") && !hl7InQueue.getHL7Source().getName().equals("local") && Context.getAdministrationService().getGlobalProperty("hl7_processor.ignore_missing_patient_non_local","false").equals("true")) {
      skipError=true;
    }
    if (!skipError)     setFatalError(hl7InQueue,"Trouble parsing HL7 message (" + hl7InQueue.getHL7SourceKey() + ")",e);
    return;
  }
catch (  Exception e) {
    setFatalError(hl7InQueue,"Exception while attempting to process HL7 In Queue (" + hl7InQueue.getHL7SourceKey() + ")",e);
  }
  try {
    Context.getHL7Service().garbageCollect();
  }
 catch (  Exception e) {
    log.error("Exception while performing garbagecollect in hl7 inbound processor",e);
  }
}
