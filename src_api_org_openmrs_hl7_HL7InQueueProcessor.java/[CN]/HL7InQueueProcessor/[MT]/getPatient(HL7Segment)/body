{
  String hl7PatientId=pid.getComponent(3,1);
  Integer patientId=null;
  Patient patient=null;
  try {
    patientId=Integer.parseInt(hl7PatientId);
  }
 catch (  NumberFormatException e) {
    throw new HL7Exception("Invalid patient ID '" + hl7PatientId + "'");
  }
  if (patientId == null || patientId == 0)   throw new HL7Exception("Unable to parse patient ID '" + hl7PatientId + "'");
  try {
    patient=context.getPatientService().getPatient(patientId);
  }
 catch (  Exception e) {
    throw new HL7Exception("Error retrieving patient " + patientId,e);
  }
  if (patient == null || patient.getPatientId() == null)   throw new HL7Exception("Could not find patient " + patientId);
  return patient;
}
