{
  Context.requirePrivilege(PrivilegeConstants.MANAGE_ENCOUNTER_VISITS);
  if (errors.hasErrors()) {
    return;
  }
  GlobalProperty gpEnableVisits=new GlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_ENABLE_VISITS,Boolean.toString(form.isEnableVisits()));
  administrationService.saveGlobalProperty(gpEnableVisits);
  if (form.isEnableVisits()) {
    String type=form.getVisitEncounterHandler();
    GlobalProperty gpVisitEncounterHandler=new GlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER,type);
    administrationService.saveGlobalProperty(gpVisitEncounterHandler);
  }
 else {
    form.setVisitEncounterHandler(administrationService.getGlobalProperty(OpenmrsConstants.GP_VISIT_ASSIGNMENT_HANDLER));
  }
  request.getSession().setAttribute(WebConstants.OPENMRS_MSG_ATTR,"Encounter.visits.configuration.savedSuccessfully");
}
