{
  if (!Context.isAuthenticated())   return new CommandObject();
  Person person=Context.getPersonService().getPerson(Integer.valueOf(request.getParameter("personId")));
  Concept concept=null;
  if (request.getParameter("conceptId") != null)   concept=Context.getConceptService().getConcept(Integer.valueOf(request.getParameter("conceptId")));
  ObsService os=Context.getObsService();
  List<Obs> ret=new ArrayList<Obs>(concept == null ? os.getObservations(person,true) : os.getObservations(person,concept,true));
  Collections.sort(ret,new Comparator<Obs>(){
    public int compare(    Obs left,    Obs right){
      int temp=left.getConcept().getName().getName().compareTo(right.getConcept().getName().getName());
      if (temp == 0)       temp=OpenmrsUtil.compareWithNullAsGreatest(left.getVoided(),right.getVoided());
      if (temp == 0)       temp=OpenmrsUtil.compareWithNullAsLatest(left.getObsDatetime(),right.getObsDatetime());
      return temp;
    }
  }
);
  return new CommandObject(person,concept,ret);
}
