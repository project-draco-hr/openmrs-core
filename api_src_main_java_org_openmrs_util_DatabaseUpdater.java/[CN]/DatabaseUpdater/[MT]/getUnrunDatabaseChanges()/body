{
  log.debug("Getting unrun changesets");
  Database database=null;
  try {
    Liquibase liquibase=getLiquibase(null,null);
    database=liquibase.getDatabase();
    List<ChangeSet> changeSets=liquibase.listUnrunChangeSets(CONTEXT);
    List<OpenMRSChangeSet> results=new ArrayList<OpenMRSChangeSet>();
    for (    ChangeSet changeSet : changeSets) {
      OpenMRSChangeSet omrschangeset=new OpenMRSChangeSet(changeSet,database);
      results.add(omrschangeset);
    }
    return results;
  }
 catch (  Exception e) {
    throw new RuntimeException("Error occurred while trying to get the updates needed for the database. " + e.getMessage(),e);
  }
 finally {
    try {
      database.getConnection().close();
    }
 catch (    Throwable t) {
    }
  }
}
