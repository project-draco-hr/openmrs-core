{
  PatientSetService pss=Context.getPatientSetService();
  Cohort cohort=null;
  if (getPatientIds() != null && getPatientIds().size() > 0) {
    cohort=new Cohort(getPatientIds());
  }
  if (location != null && !location.equals("")) {
    cohort=intersectFast(cohort,pss.getPatientsHavingLocation(getLocation()));
  }
  if (cohortId != null) {
    Cohort loadedCohort=Context.getCohortService().getCohort(cohortId);
    if (loadedCohort != null)     cohort=intersectFast(cohort,loadedCohort);
  }
  if (cohortDefinitionId != null) {
    PatientFilter cohortDefinition=(PatientFilter)Context.getReportObjectService().getReportObject(cohortDefinitionId);
    if (cohortDefinition != null) {
      cohort=cohortDefinition.filter(cohort,context);
    }
  }
  if (patientSearchId != null) {
    PatientSearchReportObject search=(PatientSearchReportObject)Context.getReportObjectService().getReportObject(patientSearchId);
    PatientFilter cohortDefinition=OpenmrsUtil.toPatientFilter(search.getPatientSearch(),null);
    cohort=cohortDefinition.filter(cohort,context);
  }
  if (cohort == null) {
    setAllPatients(true);
  }
  return cohort;
}
