{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String[] fieldTypeList=request.getParameterValues("fieldTypeId");
    FormService fs=Context.getFormService();
    String success="";
    String error="";
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String deleted=msa.getMessage("general.deleted");
    String notDeleted=msa.getMessage("general.cannot.delete");
    String textFieldType=msa.getMessage("FieldType.fieldType");
    String noneDeleted=msa.getMessage("FieldType.nonedeleted");
    if (fieldTypeList != null) {
      for (      String fieldTypeId : fieldTypeList) {
        try {
          fs.purgeFieldType(fs.getFieldType(Integer.valueOf(fieldTypeId)));
          if (!success.equals(""))           success+="<br/>";
          success+=textFieldType + " " + fieldTypeId+ " "+ deleted;
        }
 catch (        APIException e) {
          log.warn("Error deleting field type",e);
          if (!error.equals(""))           error+="<br/>";
          error+=textFieldType + " " + fieldTypeId+ " "+ notDeleted;
        }
catch (        DataIntegrityViolationException e) {
          log.error("Unable to delete a field type because it is in use. fieldTypeId: " + fieldTypeId,e);
          httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"FieldType.cannot.delete");
          return new ModelAndView(new RedirectView(getSuccessView()));
        }
      }
    }
 else {
      success+=noneDeleted;
    }
    view=getSuccessView();
    if (!success.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success);
    if (!error.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error);
  }
  return new ModelAndView(new RedirectView(view));
}
