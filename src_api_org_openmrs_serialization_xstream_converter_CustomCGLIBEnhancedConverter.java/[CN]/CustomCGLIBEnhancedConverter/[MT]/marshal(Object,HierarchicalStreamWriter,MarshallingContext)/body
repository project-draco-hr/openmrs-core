{
  SerializationMethodInvoker serializationMethodInvoker=new SerializationMethodInvoker();
  Object newObj=(Object)serializationMethodInvoker.callWriteReplace(obj);
  if (!newObj.getClass().equals(obj.getClass().getSuperclass())) {
    String attributeName=mapper.aliasForSystemAttribute("resolves-to");
    if (attributeName != null) {
      String actualClassName=this.mapper.serializedClass(newObj.getClass());
      writer.addAttribute(attributeName,actualClassName);
    }
  }
  defaultConverter.marshal(newObj,writer,context);
}
