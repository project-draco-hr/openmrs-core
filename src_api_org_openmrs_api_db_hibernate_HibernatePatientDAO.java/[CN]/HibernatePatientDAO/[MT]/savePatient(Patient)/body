{
  if (patient.getPatientId() == null) {
    sessionFactory.getCurrentSession().saveOrUpdate(patient);
    return patient;
  }
 else {
    Object obj=sessionFactory.getCurrentSession().get(Patient.class,patient.getPatientId());
    if (!(obj instanceof Patient)) {
      insertPatientStub(patient);
    }
    patient=(Patient)sessionFactory.getCurrentSession().merge(patient);
    return patient;
  }
}
