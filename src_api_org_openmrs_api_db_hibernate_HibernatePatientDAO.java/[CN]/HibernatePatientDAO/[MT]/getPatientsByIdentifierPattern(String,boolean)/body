{
  Criteria criteria=sessionFactory.getCurrentSession().createCriteria(PatientIdentifier.class);
  criteria.add(Restrictions.eq("voided",false));
  criteria.setProjection(Projections.property("patient"));
  AdministrationService adminService=Context.getAdministrationService();
  String regex=adminService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_REGEX,"");
  if (regex.equals("")) {
    String prefix=adminService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_PREFIX,"");
    String suffix=adminService.getGlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_SUFFIX,"");
    StringBuffer likeString=new StringBuffer(prefix).append(identifier).append(suffix);
    criteria.add(Expression.like("identifier",likeString.toString()));
  }
 else {
    regex=regex.replace("@SEARCH@",identifier);
    criteria.add(Restrictions.sqlRestriction("identifier regexp '" + regex + "'"));
  }
  if (includeVoided == false) {
    criteria.createAlias("patient","pat");
    criteria.add(Restrictions.eq("pat.voided",false));
  }
  criteria.setFirstResult(0);
  criteria.setMaxResults(getMaximumSearchResults());
  return criteria.list();
}
