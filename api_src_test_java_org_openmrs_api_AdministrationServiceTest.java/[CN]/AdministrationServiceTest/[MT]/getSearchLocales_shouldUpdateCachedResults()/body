{
  Context.getAdministrationService().saveGlobalProperty(new GlobalProperty(OpenmrsConstants.GLOBAL_PROPERTY_LOCALE_ALLOWED_LIST,"en_GB, en_US, pl"));
  User user=Context.getAuthenticatedUser();
  user.setUserProperty(OpenmrsConstants.USER_PROPERTY_PROFICIENT_LOCALES,"en_GB, en_US");
  Context.getUserService().saveUser(user,null);
  List<Locale> initialSearchLocales=Context.getAdministrationService().getSearchLocales();
  user=Context.getAuthenticatedUser();
  user.setUserProperty(OpenmrsConstants.USER_PROPERTY_PROFICIENT_LOCALES,"pl");
  Context.getUserService().saveUser(user,null);
  Context.getAdministrationService().getSearchLocales();
  List<Locale> cachedSearchLocales=getCachedSearchLocalesForCurrentUser();
  Assert.assertTrue("en_US",initialSearchLocales.contains(new Locale("en","US")));
  Assert.assertFalse("pl",initialSearchLocales.contains(new Locale("pl")));
  Assert.assertTrue("pl",cachedSearchLocales.contains(new Locale("pl")));
}
