{
  log.debug("committing transaction");
  Transaction tx=(Transaction)threadLocalTransaction.get();
  try {
    if (tx != null && !tx.wasCommitted() && !tx.wasRolledBack())     tx.commit();
    threadLocalTransaction.set(null);
  }
 catch (  HibernateException e) {
    rollbackTransaction();
    throw e;
  }
}
