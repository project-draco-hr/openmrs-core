{
  Set<Integer> drugIds=new HashSet<Integer>();
  if (groupMethod != null && groupMethod == GroupMethod.NONE) {
    drugIds=null;
  }
 else {
    if (drugId != null) {
      drugIds.add(drugId);
    }
    if (drugConcept != null) {
      List<Drug> drugs=Context.getConceptService().getDrugs();
      for (      Drug drug : drugs) {
        if (drug.getConcept().equals(drugConcept)) {
          drugIds.add(drug.getDrugId());
        }
      }
    }
  }
  PatientSetService service=Context.getPatientSetService();
  return service.getPatientsHavingDrugOrder(input == null ? null : input.getMemberIds(),drugIds,onDate);
}
