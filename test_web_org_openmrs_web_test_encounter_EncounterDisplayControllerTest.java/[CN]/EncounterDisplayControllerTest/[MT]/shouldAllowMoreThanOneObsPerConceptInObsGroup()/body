{
  executeDataSet("org/openmrs/web/test/encounter/include/EncounterDisplayControllerTest-multiconceptsinobsGroup.xml");
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setParameter("encounterId","5");
  EncounterDisplayController controller=new EncounterDisplayController();
  ModelAndView modelAndView=controller.handleRequest(request,new MockHttpServletResponse());
  Map<String,Object> model=(Map<String,Object>)modelAndView.getModel().get("model");
  Map<Integer,List<FieldHolder>> pages=(Map<Integer,List<FieldHolder>>)model.get("pages");
  Assert.assertNotNull(pages);
  List<FieldHolder> fieldHoldersOnPage=pages.get(999);
  for (  FieldHolder fieldHolder : fieldHoldersOnPage) {
    Assert.assertTrue(fieldHolder.isObsGrouping());
    Map<Obs,List<List<Obs>>> matrix=fieldHolder.getObsGroupMatrix();
    Assert.assertEquals(1,matrix.keySet().size());
    List<List<Obs>> listOfCells=matrix.get(new Obs(16));
    List<Obs> firstAndOnlyCell=listOfCells.get(0);
    Assert.assertEquals(2,firstAndOnlyCell.size());
    Assert.assertTrue(firstAndOnlyCell.contains(new Obs(17)));
    Assert.assertTrue(firstAndOnlyCell.contains(new Obs(18)));
  }
}
