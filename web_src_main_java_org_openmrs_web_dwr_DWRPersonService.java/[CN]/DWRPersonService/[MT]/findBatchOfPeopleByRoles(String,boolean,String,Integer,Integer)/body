{
  Vector<Object> personList=new Vector<Object>();
  try {
    if (StringUtils.isNotBlank(roles)) {
      UserService us=Context.getUserService();
      List<Role> roleList=new Vector<Role>();
      roles=roles.trim();
      String[] splitRoles=roles.split(",");
      for (      String role : splitRoles) {
        roleList.add(new Role(role));
      }
      for (      User u : us.getUsers(searchPhrase,roleList,includeRetired,start,length)) {
        personList.add(new UserListItem(u));
      }
    }
 else {
      PersonService ps=Context.getPersonService();
      for (      Person p : ps.getPeople(searchPhrase,null)) {
        personList.add(PersonListItem.createBestMatch(p));
      }
      if (searchPhrase.matches(".*\\d+.*")) {
        PatientService patientService=Context.getPatientService();
        for (        Patient p : patientService.getPatients(null,searchPhrase,null,false)) {
          personList.add(PersonListItem.createBestMatch(p));
        }
      }
    }
  }
 catch (  Exception e) {
    log.error("Error while searching for persons",e);
    personList.clear();
    personList.add(Context.getMessageSourceService().getMessage("Person.search.error") + " - " + e.getMessage());
  }
  return personList;
}
