{
  List<Integer> drugIds=new ArrayList<Integer>();
  if (getDrugList() != null)   for (  Drug d : getDrugList())   drugIds.add(d.getDrugId());
  PatientSet ps=Context.getPatientSetService().getPatientsHavingDrugOrder(input.getPatientIds(),drugIds,getAnyOrAll(),OpenmrsUtil.fromDateHelper(null,getWithinLastDays(),getWithinLastMonths(),getUntilDaysAgo(),getUntilMonthsAgo(),getSinceDate(),getUntilDate()),OpenmrsUtil.fromDateHelper(null,getWithinLastDays(),getWithinLastMonths(),getUntilDaysAgo(),getUntilMonthsAgo(),getSinceDate(),getUntilDate()));
  return input.intersect(ps);
}
