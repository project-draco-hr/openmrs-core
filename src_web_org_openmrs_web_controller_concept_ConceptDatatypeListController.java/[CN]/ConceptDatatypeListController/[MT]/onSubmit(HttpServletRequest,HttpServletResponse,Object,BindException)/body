{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  Locale locale=request.getLocale();
  String view=getFormView();
  if (context != null && context.isAuthenticated()) {
    String[] cdList=request.getParameterValues("conceptDatatypeId");
    AdministrationService as=context.getAdministrationService();
    ConceptService cs=context.getConceptService();
    String success="";
    String error="";
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String deleted=msa.getMessage("general.deleted");
    String notDeleted=msa.getMessage("general.cannot.delete");
    for (    String cd : cdList) {
      try {
        as.deleteConceptDatatype(cs.getConceptDatatype(Integer.valueOf(cd)));
        if (!success.equals(""))         success+="<br>";
        success+=cd + " " + deleted;
      }
 catch (      APIException e) {
        log.warn(e);
        if (!error.equals(""))         error+="<br>";
        error+=cd + " " + notDeleted;
      }
    }
    view=getSuccessView();
    if (!success.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success);
    if (!error.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error);
  }
  return new ModelAndView(new RedirectView(view));
}
