{
  Criteria crit=sessionFactory.getCurrentSession().createCriteria(Form.class,"form");
  if (partialName != null && !"".equals(partialName))   crit.add(Expression.like("name",partialName,MatchMode.START));
  if (published != null)   crit.add(Expression.eq("published",published));
  if (!encounterTypes.isEmpty())   crit.add(Expression.in("encounterType",encounterTypes));
  if (retired != null)   crit.add(Expression.eq("retired",retired));
  if (!containingAnyFormField.isEmpty())   crit.add(Expression.in("formField",containingAnyFormField));
  if (!containingAllFormFields.isEmpty()) {
    DetachedCriteria detachedCrit=DetachedCriteria.forClass(FormField.class,"ff");
    detachedCrit.setProjection(Projections.count("formFieldId"));
    detachedCrit.add(Expression.eqProperty("ff.formId","form.formId"));
    crit.add(Subqueries.eq(containingAllFormFields.size(),detachedCrit));
  }
  if (!fields.isEmpty()) {
    Criteria crit2=crit.createCriteria("formFields","ff");
    crit2.add(Expression.eqProperty("ff.form.formId","form.formId"));
    crit2.add(Expression.in("ff.field",fields));
  }
  return crit.list();
}
