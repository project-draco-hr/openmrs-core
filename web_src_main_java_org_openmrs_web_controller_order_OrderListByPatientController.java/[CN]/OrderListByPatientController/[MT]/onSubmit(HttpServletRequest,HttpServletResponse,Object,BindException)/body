{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String[] orderList=ServletRequestUtils.getStringParameters(request,"orderId");
    OrderService os=Context.getOrderService();
    StringBuilder success=new StringBuilder("");
    StringBuilder error=new StringBuilder("");
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String deleted=msa.getMessage("general.deleted");
    String notDeleted=msa.getMessage("general.cannot.delete");
    String ord=msa.getMessage("Order.title");
    String voidReason=ServletRequestUtils.getRequiredStringParameter(request,"voidReason");
    if (!StringUtils.hasLength(voidReason)) {
      httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"general.voidReason.empty");
      return showForm(request,response,errors);
    }
    for (    String p : orderList) {
      try {
        os.voidOrder(os.getOrder(Integer.valueOf(p)),voidReason);
        if (!success.toString().equals("")) {
          success.append("<br/>");
        }
        success.append(ord);
        success.append(" ");
        success.append(p);
        success.append(" ");
        success.append(deleted);
      }
 catch (      APIException e) {
        log.warn("Error deleting order",e);
        if (!error.equals("")) {
          error.append("<br/>");
        }
        error.append(ord).append(" ").append(p).append(" ").append(notDeleted);
      }
    }
    view=getSuccessView();
    if (ServletRequestUtils.getIntParameter(request,"patientId") != null) {
      view+="?patientId=" + ServletRequestUtils.getIntParameter(request,"patientId");
    }
    if (!success.toString().equals("")) {
      httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success.toString());
    }
    if (!error.equals("")) {
      httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error.toString());
    }
  }
  return new ModelAndView(new RedirectView(view));
}
