{
  HttpSession httpSession=request.getSession();
  String view=getFormView();
  if (Context.isAuthenticated()) {
    String[] tribeList=request.getParameterValues("tribeId");
    AdministrationService as=Context.getAdministrationService();
    PatientService ps=Context.getPatientService();
    String action="";
    if (request.getParameter("retire") != null)     action="retire";
 else     if (request.getParameter("unretire") != null)     action="unretire";
    String success="";
    String error="";
    MessageSourceAccessor msa=getMessageSourceAccessor();
    String changed=msa.getMessage("general.changed");
    String notChanged=msa.getMessage("general.cannot.change");
    for (    String t : tribeList) {
      try {
        if (action.equals("retire"))         as.retireTribe(ps.getTribe(Integer.valueOf(t)));
        if (action.equals("unretire"))         as.unretireTribe(ps.getTribe(Integer.valueOf(t)));
        if (!success.equals(""))         success+="<br/>";
        success+=t + " " + changed;
      }
 catch (      APIException e) {
        log.warn("Error deleting tribe",e);
        if (!error.equals(""))         error+="<br/>";
        error+=t + " " + notChanged;
      }
    }
    view=getSuccessView();
    if (!success.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_MSG_ATTR,success);
    if (!error.equals(""))     httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,error);
  }
  return new ModelAndView(new RedirectView(view));
}
