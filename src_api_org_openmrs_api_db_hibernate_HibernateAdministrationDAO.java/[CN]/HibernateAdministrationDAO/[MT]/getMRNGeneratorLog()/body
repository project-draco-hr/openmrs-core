{
  Collection<Map<String,Object>> logs=new Vector<Map<String,Object>>();
  PreparedStatement ps=null;
  try {
    Map<String,Object> row;
    String sql="select * from `";
    sql+=OpenmrsConstants.DATABASE_BUSINESS_NAME + "`.ext_mrn_log ";
    sql+="order by mrn_log_id desc";
    ps=sessionFactory.getCurrentSession().connection().prepareStatement(sql);
    ResultSet rs=ps.executeQuery();
    while (rs.next()) {
      row=new HashMap<String,Object>();
      row.put("date",rs.getTimestamp("date_generated"));
      row.put("user",rs.getString("generated_by"));
      row.put("site",rs.getString("site"));
      row.put("first",rs.getInt("mrn_first"));
      row.put("count",rs.getInt("mrn_count"));
      logs.add(row);
    }
  }
 catch (  Exception e) {
    throw new DAOException("Error getting mrn log",e);
  }
 finally {
    if (ps != null) {
      try {
        ps.close();
      }
 catch (      SQLException e) {
        log.error("Error generated while closing statement",e);
      }
    }
  }
  return logs;
}
