{
  Set<ConceptSetDerived> updates=new HashSet<ConceptSetDerived>();
  ConceptSetDerived derivedSet=null;
  for (  ConceptSet childSet : current.getConceptSets()) {
    Concept child=childSet.getConcept();
    log.debug("Deriving child: " + child.getConceptId());
    Double sort_weight=childSet.getSortWeight();
    for (    Concept parent : parents) {
      log.debug("Matching child: " + child.getConceptId() + " with parent: "+ parent.getConceptId());
      derivedSet=new ConceptSetDerived(parent,child,sort_weight++);
      updates.add(derivedSet);
    }
    if (child.isSet()) {
      log.debug("Concept id: " + child.getConceptId() + " is a set");
      List<Concept> new_parents=new Vector<Concept>();
      new_parents.addAll(parents);
      new_parents.add(child);
      updates.addAll(deriveChildren(new_parents,child));
    }
  }
  return updates;
}
