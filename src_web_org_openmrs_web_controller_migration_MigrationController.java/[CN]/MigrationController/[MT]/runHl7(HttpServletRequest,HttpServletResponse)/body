{
  HttpSession httpSession=request.getSession();
  Context context=(Context)httpSession.getAttribute(WebConstants.OPENMRS_CONTEXT_HTTPSESSION_ATTR);
  if (context == null) {
    httpSession.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"auth.session.expired");
    response.sendRedirect(request.getContextPath() + "/logout");
    return null;
  }
  String hl7=request.getParameter("hl7");
  hl7=hl7.replaceAll("\\n","");
  HL7InQueue hl7InQueue=new HL7InQueue();
  hl7InQueue.setHL7Data(hl7);
  HL7Service hs=context.getHL7Service();
  if (hs.getHL7Sources().isEmpty()) {
    HL7Source hl7Source=new HL7Source();
    hl7Source.setName("MigrationTestTool");
    hl7Source.setDescription("Testing migrating data, from MigrationController.");
    hs.createHL7Source(hl7Source);
  }
  hl7InQueue.setHL7Source(context.getHL7Service().getHL7Source(1));
  context.getHL7Service().createHL7InQueue(hl7InQueue);
  return new ModelAndView(new RedirectView("migration.form"));
}
