{
  Map<Integer,PatientIdentifier> patientIdentifiers=new HashMap<Integer,PatientIdentifier>();
  Criteria criteria=sessionFactory.getCurrentSession().createCriteria(PatientIdentifier.class);
  criteria.setCacheMode(CacheMode.IGNORE);
  if (patients != null)   criteria.add(Restrictions.in("patient.personId",patients.getPatientIds()));
  criteria.add(Restrictions.eq("voided",false));
  if (types != null && types.size() > 0)   criteria.add(Restrictions.in("identifierType",types));
  criteria.addOrder(org.hibernate.criterion.Order.desc("patient.personId"));
  List<PatientIdentifier> identifiers=criteria.list();
  log.info("IDS: " + identifiers);
  for (  PatientIdentifier identifier : identifiers) {
    Integer patientId=identifier.getPatient().getPatientId();
    if (!patientIdentifiers.containsKey(patientId))     patientIdentifiers.put(patientId,identifier);
  }
  return patientIdentifiers;
}
