{
  Map<Integer,List<Obs>> ret=new HashMap<Integer,List<Obs>>();
  Criteria criteria=sessionFactory.getCurrentSession().createCriteria(Obs.class);
  criteria.setCacheMode(CacheMode.IGNORE);
  criteria.add(Restrictions.eq("concept",concept));
  if (patients != null)   criteria.add(Restrictions.in("person.personId",patients.getPatientIds()));
  criteria.add(Restrictions.eq("voided",false));
  criteria.addOrder(org.hibernate.criterion.Order.desc("obsDatetime"));
  log.debug("criteria: " + criteria);
  List<Obs> temp=criteria.list();
  for (  Obs obs : temp) {
    Integer ptId=obs.getPersonId();
    List<Obs> forPatient=ret.get(ptId);
    if (forPatient == null) {
      forPatient=new ArrayList<Obs>();
      ret.put(ptId,forPatient);
    }
    forPatient.add(obs);
  }
  return ret;
}
