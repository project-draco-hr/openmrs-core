{
  Session session=HibernateUtil.currentSession();
  HibernateUtil.beginTransaction();
  Map<Integer,List<Obs>> ret=new HashMap<Integer,List<Obs>>();
  Set<Integer> ids=patients.getPatientIds();
  Criteria criteria=session.createCriteria(Obs.class);
  criteria.add(Restrictions.eq("concept",concept));
  criteria.add(Restrictions.in("patient.patientId",ids));
  criteria.addOrder(org.hibernate.criterion.Order.asc("obsDatetime"));
  log.debug("criteria: " + criteria);
  List<Obs> temp=criteria.list();
  for (  Obs obs : temp) {
    Integer ptId=obs.getPatient().getPatientId();
    List<Obs> forPatient=ret.get(ptId);
    if (forPatient == null) {
      forPatient=new ArrayList<Obs>();
      ret.put(ptId,forPatient);
    }
    forPatient.add(obs);
  }
  HibernateUtil.commitTransaction();
  return ret;
}
