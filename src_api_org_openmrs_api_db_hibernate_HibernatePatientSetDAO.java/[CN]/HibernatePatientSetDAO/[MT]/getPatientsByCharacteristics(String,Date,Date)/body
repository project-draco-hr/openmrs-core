{
  Session session=HibernateUtil.currentSession();
  HibernateUtil.beginTransaction();
  Query query;
  StringBuffer queryString=new StringBuffer("select patientId from Patient patient");
  List<String> clauses=new ArrayList<String>();
  clauses.add("patient.voided = false");
  if (gender != null) {
    gender=gender.toUpperCase();
    clauses.add("patient.gender = :gender");
  }
  if (minBirthdate != null) {
    clauses.add("patient.birthdate >= :minBirthdate");
  }
  if (maxBirthdate != null) {
    clauses.add("patient.birthdate <= :maxBirthdate");
  }
  boolean first=true;
  for (  String clause : clauses) {
    if (first) {
      queryString.append(" where ").append(clause);
      first=false;
    }
 else {
      queryString.append(" and ").append(clause);
    }
  }
  query=session.createQuery(queryString.toString());
  if (gender != null) {
    query.setString("gender",gender);
  }
  if (minBirthdate != null) {
    query.setDate("minBirthdate",minBirthdate);
  }
  if (maxBirthdate != null) {
    query.setDate("maxBirthdate",maxBirthdate);
  }
  List<Integer> patientIds=query.list();
  PatientSet ret=new PatientSet();
  ret.setPatientIds(new HashSet<Integer>(patientIds));
  HibernateUtil.commitTransaction();
  return ret;
}
