{
  Session session=HibernateUtil.currentSession();
  HibernateUtil.beginTransaction();
  Map<Integer,String> ret=new HashMap<Integer,String>();
  Set<Integer> ids=patients.getPatientIds();
  Query query=session.createQuery("select patient.patientId, patient.gender, patient.birthdate from Patient patient");
  List<Object[]> temp=query.list();
  long now=System.currentTimeMillis();
  for (  Object[] results : temp) {
    if (!ids.contains(results[0])) {
      continue;
    }
    StringBuffer sb=new StringBuffer();
    if ("M".equals(results[1])) {
      sb.append("Male");
    }
 else {
      sb.append("Female");
    }
    Date bd=(Date)results[2];
    if (bd != null) {
      int age=(int)((now - bd.getTime()) / MS_PER_YEAR);
      sb.append(", ").append(age).append(" years old");
    }
    ret.put((Integer)results[0],sb.toString());
  }
  HibernateUtil.commitTransaction();
  return ret;
}
