{
  if (drugOrders == null || drugOrders.isEmpty()) {
    log.error("ForEachDrugOrderTag skipping body due to drugOrders param being null or empty: " + drugOrders);
    return SKIP_BODY;
  }
  matchingDrugOrders=new ArrayList<DrugOrder>();
  for (Iterator<DrugOrder> i=drugOrders.iterator(); i.hasNext(); ) {
    DrugOrder d=i.next();
    if (d != null) {
      matchingDrugOrders.add(d);
    }
  }
  log.debug("ForEachDrugOrderTag found " + matchingDrugOrders.size() + " drug orders");
  if (sortBy == null || sortBy.equals("")) {
    sortBy=defaultSortBy;
  }
  Comparator comp=new BeanComparator(sortBy,(descending ? new ReverseComparator(new ComparableComparator()) : new ComparableComparator()));
  try {
    Collections.sort(matchingDrugOrders,comp);
  }
 catch (  ClassCastException cce) {
    log.error("ForEachDrugTag unable to compare the list of drug orders passed.  Ensure they are compatible with Comparator used.");
  }
  if (matchingDrugOrders.isEmpty()) {
    return SKIP_BODY;
  }
 else {
    pageContext.setAttribute(var,matchingDrugOrders.get(count++));
    return EVAL_BODY_BUFFERED;
  }
}
