{
  Map<Integer,PatientProgram> patientIdProgramMap;
  if (programMap.containsKey(programName)) {
    patientIdProgramMap=programMap.get(programName);
  }
 else {
    Program program=null;
    try {
      program=Context.getProgramWorkflowService().getProgram(Integer.valueOf(programName));
    }
 catch (    NumberFormatException ex) {
    }
    if (program == null) {
      program=Context.getProgramWorkflowService().getProgram(programName);
    }
    patientIdProgramMap=patientSetService.getPatientPrograms(getPatientSetIfNotAllPatients(),program);
    programMap.put(programName,patientIdProgramMap);
  }
  return patientIdProgramMap.get(patientId);
}
