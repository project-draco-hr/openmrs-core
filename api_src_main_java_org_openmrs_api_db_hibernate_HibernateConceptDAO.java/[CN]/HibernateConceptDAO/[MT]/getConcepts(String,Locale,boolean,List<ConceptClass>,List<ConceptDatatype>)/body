{
  Criteria criteria=sessionFactory.getCurrentSession().createCriteria(Concept.class);
  criteria.add(Restrictions.eq("retired",false));
  if (!StringUtils.isBlank(name)) {
    if (loc == null)     loc=Context.getLocale();
    criteria.createAlias("names","names");
    MatchMode matchmode=MatchMode.EXACT;
    if (searchOnPhrase)     matchmode=MatchMode.ANYWHERE;
    criteria.add(Restrictions.ilike("names.name",name,matchmode));
    criteria.add(Restrictions.eq("names.voided",false));
    String language=loc.getLanguage();
    if (language.length() > 2) {
      criteria.add(Restrictions.or(Restrictions.eq("names.locale",loc),Restrictions.eq("names.locale",new Locale(loc.getLanguage().substring(0,2)))));
    }
 else {
    }
  }
  if (classes.size() > 0)   criteria.add(Restrictions.in("conceptClass",classes));
  if (datatypes.size() > 0)   criteria.add(Restrictions.in("datatype",datatypes));
  return criteria.list();
}
