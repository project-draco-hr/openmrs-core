{
  boolean isNameField=false;
  try {
    Concept.class.getDeclaredField(sortBy);
  }
 catch (  NoSuchFieldException e) {
    try {
      ConceptName.class.getDeclaredField(sortBy);
      isNameField=true;
    }
 catch (    NoSuchFieldException e2) {
      sortBy="conceptId";
    }
  }
  String hql="";
  if (isNameField) {
    hql+="select concept";
  }
  hql+=" from Concept concept";
  if (isNameField) {
    hql+=" left join concept.names as names";
  }
  if (isNameField || !includeRetired) {
    hql+=" where";
  }
  if (isNameField) {
    hql+=" names.conceptNameType = 'FULLY_SPECIFIED'";
  }
  if (isNameField && !includeRetired) {
    hql+=" and";
  }
  if (!includeRetired) {
    hql+=" retired = false";
  }
  if (isNameField) {
    hql+=" order by names." + sortBy;
  }
 else {
    hql+=" order by concept." + sortBy;
  }
  hql+=asc ? " asc" : " desc";
  Query query=sessionFactory.getCurrentSession().createQuery(hql);
  return (List<Concept>)query.list();
}
