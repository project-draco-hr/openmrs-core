{
  StringBuilder sb=new StringBuilder();
  if (conceptId != null)   concept=Context.getConceptService().getConcept(conceptId);
  if (concept != null) {
    printConcept(sb,concept);
  }
  if (obsValue != null)   sb.append(obsValue.getValueAsString(Context.getLocale()));
  if (userId != null)   user=Context.getUserService().getUser(userId);
  if (user != null)   printUser(sb,user);
  if (personId != null)   person=Context.getPersonService().getPerson(personId);
  if (person != null)   printPerson(sb,person);
  if (encounterId != null)   encounter=Context.getEncounterService().getEncounter(encounterId);
  if (encounter != null) {
    printMetadata(sb,encounter.getEncounterType());
    sb.append(" @");
    printMetadata(sb,encounter.getLocation());
    sb.append(" | ");
    printDate(sb,encounter.getEncounterDatetime());
    sb.append(" | ");
    printPerson(sb,encounter.getProvider());
  }
  if (encounterTypeId != null)   encounterType=Context.getEncounterService().getEncounterType(encounterTypeId);
  if (encounterType != null) {
    printMetadata(sb,encounterType);
  }
  if (visitTypeId != null)   visitType=Context.getVisitService().getVisitType(visitTypeId);
  if (visitType != null) {
    printMetadata(sb,visitType);
  }
  if (visitId != null)   visit=Context.getVisitService().getVisit(visitId);
  if (visit != null) {
    printMetadata(sb,visit.getVisitType());
    sb.append(" @");
    printMetadata(sb,visit.getLocation());
    sb.append(" | ");
    printDate(sb,visit.getStartDatetime());
  }
  if (locationId != null)   location=Context.getLocationService().getLocation(locationId);
  if (location != null) {
    printMetadata(sb,location);
  }
  if (locationTagId != null)   locationTag=Context.getLocationService().getLocationTag(locationTagId);
  if (locationTag != null) {
    printMetadata(sb,locationTag);
  }
  if (programId != null)   program=Context.getProgramWorkflowService().getProgram(programId);
  if (program != null) {
    if (StringUtils.hasText(program.getName())) {
      printMetadata(sb,program);
    }
 else     if (program.getConcept() != null) {
      printConcept(sb,program.getConcept());
    }
  }
  if (providerId != null)   provider=Context.getProviderService().getProvider(providerId);
  if (provider != null)   printProvider(sb,provider);
  if (encounterProviders != null) {
    printEncounterProviders(sb,encounterProviders);
  }
  if (form != null) {
    printForm(sb,form);
  }
  if (singleCustomValue != null) {
    printSingleCustomValue(sb,singleCustomValue);
  }
  if (StringUtils.hasText(var)) {
    if (javaScriptEscape)     pageContext.setAttribute(var,JavaScriptUtils.javaScriptEscape(sb.toString()));
 else     pageContext.setAttribute(var,sb.toString());
  }
 else {
    try {
      if (javaScriptEscape)       pageContext.getOut().write(JavaScriptUtils.javaScriptEscape(sb.toString()));
 else       pageContext.getOut().write(sb.toString());
    }
 catch (    IOException e) {
      log.error("Failed to write to pageContext.getOut()",e);
    }
  }
  return SKIP_BODY;
}
