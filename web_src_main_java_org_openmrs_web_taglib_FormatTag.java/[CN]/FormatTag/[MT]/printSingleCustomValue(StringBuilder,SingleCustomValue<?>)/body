{
  CustomValueDescriptor descriptor=val.getDescriptor();
  CustomDatatype<?> datatype=CustomDatatypeUtil.getDatatype(descriptor);
  CustomDatatypeHandler handler=CustomDatatypeUtil.getHandler(descriptor);
  if (handler != null && handler instanceof HtmlDisplayableDatatypeHandler) {
    sb.append(((HtmlDisplayableDatatypeHandler)handler).toHtmlSummary(datatype,val.getValueReference()));
  }
 else   if (datatype != null) {
    sb.append(datatype.getTextSummary(val.getValueReference()));
  }
 else {
    sb.append(val.getValueReference());
  }
}
