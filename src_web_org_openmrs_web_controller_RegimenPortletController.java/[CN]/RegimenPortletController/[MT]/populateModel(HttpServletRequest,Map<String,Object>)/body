{
  String drugSetIds=(String)model.get("displayDrugSetIds");
  if (drugSetIds != null && drugSetIds.length() > 0) {
    OrderService os=Context.getOrderService();
    Map<String,List<DrugOrder>> patientDrugOrderSets;
    Map<String,List<DrugOrder>> currentDrugOrderSets;
    Map<String,List<DrugOrder>> completedDrugOrderSets;
    if (model.containsKey("patientDrugOrderSets"))     log.debug("pdo already in model");
 else {
      patientDrugOrderSets=os.getDrugSetsByDrugSetIdList((List<DrugOrder>)model.get("patientDrugOrders"),drugSetIds,",");
      model.put("patientDrugOrderSets",patientDrugOrderSets);
    }
    if (model.containsKey("currentDrugOrderSets"))     log.debug("cdo already in req model");
 else {
      currentDrugOrderSets=os.getDrugSetsByDrugSetIdList((List<DrugOrder>)model.get("currentDrugOrders"),drugSetIds,",");
      model.put("currentDrugOrderSets",currentDrugOrderSets);
    }
    if (model.containsKey("completedDrugOrderSets"))     log.debug("ldo already in req model");
 else {
      completedDrugOrderSets=os.getDrugSetsByDrugSetIdList((List<DrugOrder>)model.get("completedDrugOrders"),drugSetIds,",");
      model.put("completedDrugOrderSets",completedDrugOrderSets);
    }
    if (!model.containsKey("drugOrderHeaders") || !model.containsKey("drugOrderDatePattern")) {
      Map<String,Concept> drugOrderHeaders=OpenmrsUtil.delimitedStringToConceptMap(drugSetIds,",");
      String datePattern=OpenmrsConstants.OPENMRS_LOCALE_DATE_PATTERNS().get(Context.getLocale().toString().toLowerCase());
      model.put("drugOrderHeaders",drugOrderHeaders);
      model.put("drugOrderDatePattern",datePattern);
    }
  }
}
