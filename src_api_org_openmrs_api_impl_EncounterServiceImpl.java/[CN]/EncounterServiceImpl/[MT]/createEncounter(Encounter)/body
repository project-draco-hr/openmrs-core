{
  if (!Context.hasPrivilege(OpenmrsConstants.PRIV_ADD_ENCOUNTERS))   throw new APIAuthenticationException("Privilege required: " + OpenmrsConstants.PRIV_ADD_ENCOUNTERS);
  if (log.isDebugEnabled())   log.debug("Creating encounter: " + encounter);
  Date now=new Date();
  User me=Context.getAuthenticatedUser();
  if (encounter.getDateCreated() == null)   encounter.setDateCreated(now);
  if (encounter.getCreator() == null)   encounter.setCreator(me);
  if (encounter.getObsAtTopLevel(false) != null) {
    for (    Obs o : encounter.getObsAtTopLevel(false)) {
      if (o.getDateCreated() == null)       o.setDateCreated(now);
      if (o.getCreator() == null)       o.setCreator(me);
    }
  }
  if (encounter.getOrders() != null) {
    for (    Order o : encounter.getOrders()) {
      if (o.getDateCreated() == null)       o.setDateCreated(now);
      if (o.getCreator() == null)       o.setCreator(me);
    }
  }
  getEncounterDAO().createEncounter(encounter);
}
