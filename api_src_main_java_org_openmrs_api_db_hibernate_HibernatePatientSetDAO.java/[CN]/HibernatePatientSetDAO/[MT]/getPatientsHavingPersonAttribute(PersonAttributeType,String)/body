{
  StringBuilder sb=new StringBuilder();
  sb.append(" select pat.patient_id ");
  sb.append(" from person p ");
  sb.append(" inner join patient pat on pat.patient_id = p.person_id and pat.voided = false ");
  sb.append(" inner join person_attribute a on p.person_id = a.person_id and a.voided = false ");
  sb.append(" where p.voided = false ");
  if (attribute != null) {
    sb.append(" and a.person_attribute_type_id = :typeId ");
  }
  if (value != null) {
    sb.append(" and a.value = :value ");
  }
  sb.append(" group by pat.patient_id ");
  log.debug("query: " + sb);
  Query query=sessionFactory.getCurrentSession().createSQLQuery(sb.toString());
  if (attribute != null) {
    query.setInteger("typeId",attribute.getPersonAttributeTypeId());
  }
  if (value != null) {
    query.setString("value",value);
  }
  return new Cohort(query.list());
}
