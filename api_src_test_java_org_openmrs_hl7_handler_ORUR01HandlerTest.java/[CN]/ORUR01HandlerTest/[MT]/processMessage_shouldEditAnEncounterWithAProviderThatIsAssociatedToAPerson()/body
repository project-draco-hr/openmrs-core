{
  executeDataSet("org/openmrs/api/include/ProviderServiceTest-initial.xml");
  int patientId=2;
  Patient patient=new Patient(patientId);
  EncounterService es=Context.getEncounterService();
  EncounterRole role=es.getEncounterRoleByUuid(EncounterRole.UNKNOWN_ENCOUNTER_ROLE_UUID);
  List<Encounter> encForPatient1=es.getEncountersByPatient(patient);
  ProviderService ps=Context.getProviderService();
  Provider provider=ps.getProvider(1);
  Assert.assertNotNull(provider.getPerson());
  int encounterId=5;
  Collection<Provider> providers=es.getEncounter(encounterId).getProvidersByRole(role);
  Assert.assertTrue(providers.size() == 1);
  Assert.assertTrue(providers.iterator().next().getPerson().getPersonId() != 6);
  String hl7string="MSH|^~\\&|FORMENTRY|AMRS.ELD|HL7LISTENER|AMRS.ELD|20080226102656||ORU^R01|JqnfhKKtouEz8kzTk6Zo|P|2.5|1||||||||16^AMRS.ELD.FORMID\r" + "PID|||" + patientId + "^^^^||Hornblower^Horatio^Test||\r"+ "PV1||O|1^Unknown Location||||6^name||||||||||||"+ encounterId+ "|||||||||||||||||||||||||20080212|||||||V\r"+ "ORC|RE||||||||20080226102537|1^Super User\r"+ "OBR|1|||1238^MEDICAL RECORD OBSERVATIONS^99DCT";
  Message hl7message=parser.parse(hl7string);
  router.processMessage(hl7message);
  List<Encounter> encForPatient2=Context.getEncounterService().getEncountersByPatient(patient);
  assertTrue("There should be no encounter created",encForPatient1.size() == encForPatient2.size());
  providers=es.getEncounter(encounterId).getProvidersByRole(role);
  Assert.assertTrue(providers.size() == 1);
  Provider newProvider=providers.iterator().next();
  Assert.assertTrue(newProvider.getPerson().getPersonId() == 6);
  Assert.assertEquals("ae401f88-6b94-11e0-93c3-18a905e044dc",newProvider.getUuid());
}
