{
  response.setContentType("text/html");
  String reportType=request.getParameter("reportType");
  HttpSession session=request.getSession();
  if (reportType == null || reportType.length() == 0) {
    session.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"error.null");
    return;
  }
  if (!Context.hasPrivilege(OpenmrsConstants.PRIV_VIEW_PATIENTS)) {
    session.setAttribute(WebConstants.OPENMRS_ERROR_ATTR,"Privilege required: " + OpenmrsConstants.PRIV_VIEW_PATIENTS);
    session.setAttribute(WebConstants.OPENMRS_LOGIN_REDIRECT_HTTPSESSION_ATTR,request.getRequestURI() + "?" + request.getQueryString());
    response.sendRedirect(request.getContextPath() + "/login.htm");
    return;
  }
  try {
    Velocity.init();
  }
 catch (  Exception e) {
    log.error("Error initializing Velocity engine",e);
  }
  VelocityContext velocityContext=new VelocityContext();
  PrintWriter report=response.getWriter();
  report.append("Report: " + reportType + "<br/><br/>\n\n");
  if (reportType.equals("RETURN VISIT DATE THIS WEEK")) {
    doReturnVisitDate(velocityContext,report,request);
  }
  if (reportType.equals("ATTENDED CLINIC THIS WEEK")) {
    doAttendedClinic(velocityContext,report,request);
  }
 else   if (reportType.equals("VOIDED OBS")) {
    doVoidedObs(velocityContext,report,request);
  }
  try {
    Velocity.evaluate(velocityContext,report,this.getClass().getName(),getTemplate(reportType));
  }
 catch (  Exception e) {
    log.error("Error evaluating report type " + reportType,e);
  }
}
